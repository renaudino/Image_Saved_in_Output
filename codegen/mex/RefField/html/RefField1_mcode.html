<!-- saved from url=(0014)about:internet -->
<html>
<body>
<script src="resources/eml_report_loadable_data.js"></script>
<pre class="code">
<span class="srcline"><span class="lineno"><a href="1,1" id="srcline1">  1</a></span><span class="line"><span class="keyword">function</span> [<span class="var type1" id="S2T1U3">Eout</span>,<span class="var type1" id="S3T2U4">Rt</span>,<span class="var type1" id="S4T2U5">Rh</span>] = RefField(<span class="var type1" id="S5T3U8">pblo</span>,<span class="var type1" id="S6T3U9">blo</span>,<span class="var type1" id="S7T4U10">E_re</span>,<span class="var type1" id="S8T4U11">R_re</span>,<span class="var type1" id="S9T5U12">qr_re</span>,<span class="var type1" id="S10T4U13">n_re</span>,<span class="var type1" id="S11T1U14">Ein</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="1,2" id="srcline2">  2</a></span><span class="line"><span class="comment">% Calculates the reflected field</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,3" id="srcline3">  3</a></span><span class="line"><span class="comment">% blo : block number for which the reflected field is evaluated		  </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,4" id="srcline4">  4</a></span><span class="line"><span class="comment">% E : transm. position                                                   </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,5" id="srcline5">  5</a></span><span class="line"><span class="comment">% R : recept pos.                                                          </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,6" id="srcline6">  6</a></span><span class="line"><span class="comment">% qr : reflecion point                                                     </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,7" id="srcline7">  7</a></span><span class="line"><span class="comment">% n : ext. norm.                                                                                                             				       </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,8" id="srcline8">  8</a></span><span class="line"><span class="comment">% Ein : incident field                                                      </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,9" id="srcline9">  9</a></span><span class="line"><span class="comment">% Eout : field at the obs. point (R)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,10" id="srcline10"> 10</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,11" id="srcline11"> 11</a></span><span class="line"><span class="comment">% Authors: Francesco Mani &lt;francesco.mani@uclouvain.be&gt; and Mingming Gan &lt;gan@ftw.at&gt;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,12" id="srcline12"> 12</a></span><span class="line"><span class="comment">% History: 2011.9.26</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,13" id="srcline13"> 13</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,14" id="srcline14"> 14</a></span><span class="line"><span class="comment">% Updated by: Xuhong Li &lt;xuhong@ftw.at&gt;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,15" id="srcline15"> 15</a></span><span class="line"><span class="comment">% History: 2013.08.01</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,16" id="srcline16"> 16</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,17" id="srcline17"> 17</a></span><span class="line"><span class="keyword">global</span> <span class="var type0" id="S12T0U16">CEP</span> <span class="var type0" id="S13T0U17">eta</span> <span class="var type0" id="S14T0U18">K</span> <span class="var type0" id="S15T0U19">Rcoeff</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,18" id="srcline18"> 18</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,19" id="srcline19"> 19</a></span><span class="line"><span class="comment">%%%%%%%%% Incident wave coordinate system calculation : eti &amp; ehi%%%%%%%%%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,20" id="srcline20"> 20</a></span><span class="line"><span class="comment">% eti is the perpendicular vector to the incident plane </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,21" id="srcline21"> 21</a></span><span class="line"><span class="comment">% ehi is the parallel vector to the incident plane</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,22" id="srcline22"> 22</a></span><span class="line"><span class="mxinfo " id="T4:U11"><span class="var type1" id="S16T4U22">vr</span> = <span class="mxinfo " id="T4:U13">zeros(<span class="mxinfo " id="T3:U14">3</span>,1)</span></span>; </span></span>
<span class="srcline"><span class="lineno"><a href="1,23" id="srcline23"> 23</a></span><span class="line"><span class="mxinfo " id="T2:U15"><span class="var type1" id="S18T2U29">ccfi</span> = <span class="mxinfo " id="T2:U17"><span class="mxinfo " id="T3:U18">0</span>+<span class="mxinfo " id="T2:U19">0i</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,24" id="srcline24"> 24</a></span><span class="line"><span class="mxinfo " id="T3:U20"><span class="var type1" id="S19T3U35">csfi2_temp</span> = <span class="mxinfo " id="T3:U22">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,25" id="srcline25"> 25</a></span><span class="line"><span class="mxinfo " id="T4:U23"><span class="var type1" id="S20T4U39">E</span> = <span class="mxinfo " id="T4:U25">reshape(<span class="var type1" id="S7T4U42">E_re</span>,3,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,26" id="srcline26"> 26</a></span><span class="line"><span class="mxinfo " id="T4:U27"><span class="var type1" id="S22T4U47">qr</span> = <span class="mxinfo " id="T4:U29">reshape(<span class="var type1" id="S9T5U50">qr_re</span>,3,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,27" id="srcline27"> 27</a></span><span class="line"><span class="mxinfo " id="T4:U31"><span class="var type1" id="S23T4U55">n</span> = <span class="mxinfo " id="T4:U33">reshape(<span class="var type1" id="S10T4U58">n_re</span>,3,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,28" id="srcline28"> 28</a></span><span class="line"><span class="mxinfo " id="T4:U35"><span class="var type1" id="S24T4U63">R</span> = <span class="mxinfo " id="T4:U37">reshape(<span class="var type1" id="S8T4U66">R_re</span>,3,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,29" id="srcline29"> 29</a></span><span class="line"><span class="mxinfo " id="T4:U39"><span class="var type1" id="S25T4U71">vi</span> = <span class="mxinfo " id="T4:U41"><span class="var type1" id="S22T4U73">qr</span> - <span class="var type1" id="S20T4U74">E</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,30" id="srcline30"> 30</a></span><span class="line"><span class="mxinfo " id="T3:U44"><span class="var type1" id="S26T3U77">di</span> = <span class="mxinfo " id="T3:U46">norm(<span class="mxinfo " id="T4:U47"><span class="var type1" id="S22T4U81">qr</span> - <span class="var type1" id="S20T4U82">E</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,31" id="srcline31"> 31</a></span><span class="line"><span class="mxinfo " id="T4:U50"><span class="var type1" id="S25T4U85">vi</span> = <span class="mxinfo " id="T4:U52"><span class="mxinfo " id="T3:U53"><span class="mxinfo " id="T3:U54">1</span>/<span class="var type1" id="S26T3U89">di</span></span>*<span class="var type1" id="S25T4U90">vi</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,32" id="srcline32"> 32</a></span><span class="line"><span class="mxinfo " id="T4:U57"><span class="mxinfo " id="T4:U58"><span class="var type1" id="S16T4U94">vr</span>(<span class="mxinfo " id="T6:U60">:</span>,<span class="mxinfo " id="T7:U61">1</span>)</span> = <span class="mxinfo " id="T4:U62"><span class="var type1" id="S24T4U98">R</span> - <span class="var type1" id="S22T4U99">qr</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,33" id="srcline33"> 33</a></span><span class="line"><span class="mxinfo " id="T3:U65"><span class="var type1" id="S28T3U102">dr</span> = <span class="mxinfo " id="T3:U67">norm(<span class="mxinfo " id="T4:U68"><span class="var type1" id="S24T4U106">R</span> - <span class="var type1" id="S22T4U107">qr</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,34" id="srcline34"> 34</a></span><span class="line"><span class="mxinfo " id="T4:U71"><span class="var type1" id="S16T4U110">vr</span> = <span class="mxinfo " id="T4:U73"><span class="mxinfo " id="T3:U74"><span class="mxinfo " id="T3:U75">1</span>/<span class="var type1" id="S28T3U114">dr</span></span>*<span class="var type1" id="S16T4U115">vr</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,35" id="srcline35"> 35</a></span><span class="line"><span class="mxinfo " id="T4:U78"><span class="var type1" id="S29T4U118">eti</span> = <span class="mxinfo " id="T4:U80">cross(<span class="var type1" id="S25T4U121">vi</span>,<span class="var type1" id="S23T4U122">n</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,36" id="srcline36"> 36</a></span><span class="line"><span class="mxinfo " id="T2:U83"><span class="var type1" id="S31T2U125">csfi2</span> = <span class="mxinfo " id="T2:U85">complex(<span class="mxinfo " id="T3:U86"><span class="mxinfo " id="T3:U87">norm(<span class="var type1" id="S29T4U131">eti</span>)</span>^2</span>,<span class="mxinfo " id="T3:U89">0</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,37" id="srcline37"> 37</a></span><span class="line"><span class="mxinfo " id="T3:U90"><span class="var type1" id="S19T3U136">csfi2_temp</span> = <span class="mxinfo " id="T3:U92">real(<span class="mxinfo " id="T2:U93">sqrt(<span class="mxinfo " id="T2:U94"><span class="mxinfo " id="T3:U95">1</span>-<span class="var type1" id="S31T2U143">csfi2</span></span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,38" id="srcline38"> 38</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo " id="T8:U97">(<span class="mxinfo " id="T2:U98"><span class="mxinfo " id="T3:U99">1</span>-<span class="var type1" id="S31T2U150">csfi2</span></span>)&lt;<span class="mxinfo " id="T3:U101">0</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,39" id="srcline39"> 39</a></span><span class="line">    <span class="mxinfo " id="T2:U102"><span class="var type1" id="S18T2U154">ccfi</span> = <span class="mxinfo " id="T2:U104">complex(<span class="mxinfo " id="T3:U105">0</span>,<span class="mxinfo " id="T3:U106">0</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,40" id="srcline40"> 40</a></span><span class="line"><span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,41" id="srcline41"> 41</a></span><span class="line">    <span class="mxinfo " id="T2:U107"><span class="var type1" id="S18T2U162">ccfi</span> = <span class="mxinfo " id="T2:U109">complex(<span class="var type1" id="S19T3U165">csfi2_temp</span>,<span class="mxinfo " id="T3:U111">0</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,42" id="srcline42"> 42</a></span><span class="line"><span class="keyword">end</span> </span></span>
<span class="srcline"><span class="lineno"><a href="1,43" id="srcline43"> 43</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,44" id="srcline44"> 44</a></span><span class="line"><span class="keyword">if</span> (<span class="mxinfo " id="T8:U112"><span class="mxinfo " id="T3:U113">norm(<span class="var type1" id="S29T4U173">eti</span>)</span> &lt;= <span class="mxinfo " id="T3:U115">1.0e-6</span></span>)</span></span>
<span class="srcline"><span class="lineno"><a href="1,45" id="srcline45"> 45</a></span><span class="line">    <span class="mxinfo " id="T4:U116"><span class="var type1" id="S29T4U177">eti</span> = <span class="mxinfo " id="T4:U118">[<span class="mxinfo " id="T3:U119">0</span>;<span class="mxinfo " id="T3:U120">0</span>;<span class="mxinfo " id="T3:U121">1</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,46" id="srcline46"> 46</a></span><span class="line"><span class="keyword">end</span> </span></span>
<span class="srcline"><span class="lineno"><a href="1,47" id="srcline47"> 47</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,48" id="srcline48"> 48</a></span><span class="line"><span class="mxinfo " id="T4:U122"><span class="var type1" id="S29T4U187">eti</span> = <span class="mxinfo " id="T4:U124"><span class="mxinfo " id="T3:U125"><span class="mxinfo " id="T3:U126">1</span>/<span class="mxinfo " id="T3:U127">norm(<span class="var type1" id="S29T4U193">eti</span>)</span></span>*<span class="var type1" id="S29T4U194">eti</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,49" id="srcline49"> 49</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,50" id="srcline50"> 50</a></span><span class="line"><span class="mxinfo " id="T4:U130"><span class="var type1" id="S35T4U197">ehi</span> = <span class="mxinfo " id="T4:U132">cross(<span class="var type1" id="S29T4U200">eti</span>,<span class="var type1" id="S25T4U201">vi</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,51" id="srcline51"> 51</a></span><span class="line"><span class="mxinfo " id="T4:U135"><span class="var type1" id="S36T4U204">ehr</span> = <span class="mxinfo " id="T4:U137">cross(<span class="var type1" id="S29T4U207">eti</span>,<span class="var type1" id="S16T4U208">vr</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,52" id="srcline52"> 52</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,53" id="srcline53"> 53</a></span><span class="line"><span class="comment">%%%%%%%%%%%%%%%%% E components in the SW-fixed coord. syst.%%%%%%%%%%%%%%%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,54" id="srcline54"> 54</a></span><span class="line"><span class="comment">%coEh = dot(ehi,Ein);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,55" id="srcline55"> 55</a></span><span class="line"><span class="comment">%coEt = dot(eti,Ein);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,56" id="srcline56"> 56</a></span><span class="line"><span class="mxinfo " id="T2:U140"><span class="var type1" id="S37T2U211">coEh</span> = <span class="mxinfo " id="T2:U142"><span class="mxinfo " id="T9:U143"><span class="var type1" id="S35T4U214">ehi</span>'</span>*<span class="var type1" id="S11T1U215">Ein</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,57" id="srcline57"> 57</a></span><span class="line"><span class="mxinfo " id="T2:U146"><span class="var type1" id="S38T2U218">coEt</span> = <span class="mxinfo " id="T2:U148"><span class="mxinfo " id="T9:U149"><span class="var type1" id="S29T4U221">eti</span>'</span>*<span class="var type1" id="S11T1U222">Ein</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,58" id="srcline58"> 58</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,59" id="srcline59"> 59</a></span><span class="line"><span class="comment">% if blo == 0</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,60" id="srcline60"> 60</a></span><span class="line"><span class="comment">%     if GCEP == 1</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,61" id="srcline61"> 61</a></span><span class="line"><span class="comment">%         Rh = complex(1,0);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,62" id="srcline62"> 62</a></span><span class="line"><span class="comment">%         Rt = complex(-1,0);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,63" id="srcline63"> 63</a></span><span class="line"><span class="comment">%     else</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,64" id="srcline64"> 64</a></span><span class="line"><span class="comment">%         if (pblo == -1)    % previous medium is air</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,65" id="srcline65"> 65</a></span><span class="line"><span class="comment">%              Ct = Geta - csfi2;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,66" id="srcline66"> 66</a></span><span class="line"><span class="comment">%              Ch = Ct/(Geta^2);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,67" id="srcline67"> 67</a></span><span class="line"><span class="comment">%              Rt = (ccfi-sqrt(Ct))/(ccfi+sqrt(Ct));</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,68" id="srcline68"> 68</a></span><span class="line"><span class="comment">%              Rh = (ccfi-sqrt(Ch))/(ccfi+sqrt(Ch));</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,69" id="srcline69"> 69</a></span><span class="line"><span class="comment">%         else     % previous medium is not air</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,70" id="srcline70"> 70</a></span><span class="line"><span class="comment">%              Ct = (Geta/eta(pblo)) - csfi2;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,71" id="srcline71"> 71</a></span><span class="line"><span class="comment">%              Ch = Ct/((Geta/eta(pblo))^2);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,72" id="srcline72"> 72</a></span><span class="line"><span class="comment">%              Rt = (ccfi-sqrt(Ct))/(ccfi+sqrt(Ct));</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,73" id="srcline73"> 73</a></span><span class="line"><span class="comment">%              Rh = (ccfi-sqrt(Ch))/(ccfi+sqrt(Ch));</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,74" id="srcline74"> 74</a></span><span class="line"><span class="comment">%         end </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,75" id="srcline75"> 75</a></span><span class="line"><span class="comment">%     end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,76" id="srcline76"> 76</a></span><span class="line"><span class="comment">% else</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,77" id="srcline77"> 77</a></span><span class="line">    <span class="keyword">if</span> (<span class="mxinfo " id="T8:U152"><span class="mxinfo " id="T3:U153"><span class="var type1" id="S12T10U228">CEP</span>(<span class="var type1" id="S6T3U229">blo</span>)</span> == <span class="mxinfo " id="T3:U156">1</span></span>)</span></span>
<span class="srcline"><span class="lineno"><a href="1,78" id="srcline78"> 78</a></span><span class="line">        <span class="mxinfo " id="T2:U157"><span class="var type1" id="S4T2U233">Rh</span> = <span class="mxinfo " id="T2:U159">complex(<span class="mxinfo " id="T3:U160">1</span>,<span class="mxinfo " id="T3:U161">0</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,79" id="srcline79"> 79</a></span><span class="line">        <span class="mxinfo " id="T2:U162"><span class="var type1" id="S3T2U240">Rt</span> = <span class="mxinfo " id="T2:U164">complex(<span class="mxinfo " id="T3:U165">-<span class="mxinfo " id="T3:U166">1</span></span>,<span class="mxinfo " id="T3:U167">0</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,80" id="srcline80"> 80</a></span><span class="line">    <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,81" id="srcline81"> 81</a></span><span class="line">        <span class="keyword">if</span> (<span class="mxinfo " id="T8:U168"><span class="var type1" id="S5T3U251">pblo</span> == <span class="mxinfo " id="T3:U170">-<span class="mxinfo " id="T3:U171">1</span></span></span>)</span></span>
<span class="srcline"><span class="lineno"><a href="1,82" id="srcline82"> 82</a></span><span class="line">            <span class="mxinfo " id="T2:U172"><span class="var type1" id="S39T2U256">Ct</span> = <span class="mxinfo " id="T2:U174"><span class="mxinfo " id="T2:U175"><span class="var type1" id="S13T11U259">eta</span>(<span class="var type1" id="S6T3U260">blo</span>)</span> - <span class="var type1" id="S31T2U261">csfi2</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,83" id="srcline83"> 83</a></span><span class="line">            <span class="mxinfo " id="T2:U179"><span class="var type1" id="S40T2U264">Ch</span> = <span class="mxinfo " id="T2:U181"><span class="var type1" id="S39T2U266">Ct</span>/(<span class="mxinfo " id="T2:U183"><span class="mxinfo " id="T2:U184"><span class="var type1" id="S13T11U270">eta</span>(<span class="var type1" id="S6T3U271">blo</span>)</span>^2</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,84" id="srcline84"> 84</a></span><span class="line">            <span class="mxinfo " id="T2:U187"><span class="var type1" id="S3T2U275">Rt</span> = <span class="mxinfo " id="T2:U189">(<span class="mxinfo " id="T2:U190"><span class="var type1" id="S18T2U279">ccfi</span>-<span class="mxinfo " id="T2:U192">sqrt(<span class="var type1" id="S39T2U282">Ct</span>)</span></span>)/(<span class="mxinfo " id="T2:U194"><span class="var type1" id="S18T2U285">ccfi</span>+<span class="mxinfo " id="T2:U196">sqrt(<span class="var type1" id="S39T2U288">Ct</span>)</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,85" id="srcline85"> 85</a></span><span class="line">            <span class="mxinfo " id="T2:U198"><span class="var type1" id="S4T2U291">Rh</span> = <span class="mxinfo " id="T2:U200">(<span class="mxinfo " id="T2:U201"><span class="var type1" id="S18T2U295">ccfi</span>-<span class="mxinfo " id="T2:U203">sqrt(<span class="var type1" id="S40T2U298">Ch</span>)</span></span>)/(<span class="mxinfo " id="T2:U205"><span class="var type1" id="S18T2U301">ccfi</span>+<span class="mxinfo " id="T2:U207">sqrt(<span class="var type1" id="S40T2U304">Ch</span>)</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,86" id="srcline86"> 86</a></span><span class="line">        <span class="keyword">else</span> </span></span>
<span class="srcline"><span class="lineno"><a href="1,87" id="srcline87"> 87</a></span><span class="line">            <span class="mxinfo " id="T2:U209"><span class="var type1" id="S39T2U308">Ct</span> = <span class="mxinfo " id="T2:U211">(<span class="mxinfo " id="T2:U212"><span class="mxinfo " id="T2:U213"><span class="var type1" id="S13T11U313">eta</span>(<span class="var type1" id="S6T3U314">blo</span>)</span>/<span class="mxinfo " id="T2:U216"><span class="var type1" id="S13T11U316">eta</span>(<span class="var type1" id="S5T3U317">pblo</span>)</span></span>) - <span class="var type1" id="S31T2U318">csfi2</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,88" id="srcline88"> 88</a></span><span class="line">            <span class="mxinfo " id="T2:U220"><span class="var type1" id="S40T2U321">Ch</span> = <span class="mxinfo " id="T2:U222"><span class="var type1" id="S39T2U323">Ct</span>/(<span class="mxinfo " id="T2:U224">(<span class="mxinfo " id="T2:U225"><span class="mxinfo " id="T2:U226"><span class="var type1" id="S13T11U329">eta</span>(<span class="var type1" id="S6T3U330">blo</span>)</span>/<span class="mxinfo " id="T2:U229"><span class="var type1" id="S13T11U332">eta</span>(<span class="var type1" id="S5T3U333">pblo</span>)</span></span>)^2</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,89" id="srcline89"> 89</a></span><span class="line">            <span class="mxinfo " id="T2:U232"><span class="var type1" id="S3T2U337">Rt</span> = <span class="mxinfo " id="T2:U234">(<span class="mxinfo " id="T2:U235"><span class="var type1" id="S18T2U341">ccfi</span>-<span class="mxinfo " id="T2:U237">sqrt(<span class="var type1" id="S39T2U344">Ct</span>)</span></span>)/(<span class="mxinfo " id="T2:U239"><span class="var type1" id="S18T2U347">ccfi</span>+<span class="mxinfo " id="T2:U241">sqrt(<span class="var type1" id="S39T2U350">Ct</span>)</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,90" id="srcline90"> 90</a></span><span class="line">            <span class="mxinfo " id="T2:U243"><span class="var type1" id="S4T2U353">Rh</span> = <span class="mxinfo " id="T2:U245">(<span class="mxinfo " id="T2:U246"><span class="var type1" id="S18T2U357">ccfi</span>-<span class="mxinfo " id="T2:U248">sqrt(<span class="var type1" id="S40T2U360">Ch</span>)</span></span>)/(<span class="mxinfo " id="T2:U250"><span class="var type1" id="S18T2U363">ccfi</span>+<span class="mxinfo " id="T2:U252">sqrt(<span class="var type1" id="S40T2U366">Ch</span>)</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,91" id="srcline91"> 91</a></span><span class="line">        <span class="keyword">end</span> </span></span>
<span class="srcline"><span class="lineno"><a href="1,92" id="srcline92"> 92</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,93" id="srcline93"> 93</a></span><span class="line"><span class="comment">% end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,94" id="srcline94"> 94</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,95" id="srcline95"> 95</a></span><span class="line"><span class="mxinfo " id="T2:U254"><span class="var type1" id="S41T2U369">fac</span> = <span class="mxinfo " id="T2:U256">exp(<span class="mxinfo " id="T2:U257"><span class="mxinfo " id="T2:U258"><span class="mxinfo " id="T2:U259">-1i</span>*<span class="var type1" id="S14T3U376">K</span></span>*<span class="var type1" id="S28T3U377">dr</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,96" id="srcline96"> 96</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,97" id="srcline97"> 97</a></span><span class="line"><span class="mxinfo " id="T1:U262"><span class="var type1" id="S2T1U380">Eout</span> = <span class="mxinfo " id="T1:U264"><span class="var type1" id="S41T2U382">fac</span>*(<span class="mxinfo " id="T1:U266">(<span class="mxinfo " id="T1:U267"><span class="var type1" id="S36T4U387">ehr</span>*(<span class="mxinfo " id="T2:U269"><span class="var type1" id="S4T2U390">Rh</span>*<span class="var type1" id="S37T2U391">coEh</span></span>)</span>)+(<span class="mxinfo " id="T1:U272"><span class="var type1" id="S29T4U394">eti</span>*(<span class="mxinfo " id="T2:U274"><span class="var type1" id="S3T2U397">Rt</span>*<span class="var type1" id="S38T2U398">coEt</span></span>)</span>)</span>)</span></span>; </span></span>
<span class="srcline"><span class="lineno"><a href="1,98" id="srcline98"> 98</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,99" id="srcline99"> 99</a></span><span class="line"><span class="comment">% if blo == 0    % updated on 18.10.2011: multiplying the field and the R coeff. that takes into account the diffuse scattering power reduction</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,100" id="srcline100">100</a></span><span class="line"><span class="comment">%     Eout = GRcoeff*Eout;    </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,101" id="srcline101">101</a></span><span class="line"><span class="comment">% else </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,102" id="srcline102">102</a></span><span class="line">    <span class="mxinfo " id="T1:U277"><span class="var type1" id="S2T1U401">Eout</span> = <span class="mxinfo " id="T1:U279"><span class="mxinfo " id="T3:U280"><span class="var type1" id="S15T10U404">Rcoeff</span>(<span class="var type1" id="S6T3U405">blo</span>)</span>*<span class="var type1" id="S2T1U406">Eout</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,103" id="srcline103">103</a></span><span class="line"><span class="comment">% end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,104" id="srcline104">104</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,105" id="srcline105">105</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,106" id="srcline106">106</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,107" id="srcline107">107</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,108" id="srcline108">108</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,109" id="srcline109">109</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,110" id="srcline110">110</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,111" id="srcline111">111</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,112" id="srcline112">112</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,113" id="srcline113">113</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,114" id="srcline114">114</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,115" id="srcline115">115</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,116" id="srcline116">116</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,117" id="srcline117">117</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,118" id="srcline118">118</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,119" id="srcline119">119</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,120" id="srcline120">120</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,121" id="srcline121">121</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,122" id="srcline122">122</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,123" id="srcline123">123</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,124" id="srcline124">124</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,125" id="srcline125">125</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,126" id="srcline126">126</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,127" id="srcline127">127</a></span><span class="line"></span></span>
</pre>
</body>
</html>
