<!-- saved from url=(0014)about:internet -->
<html>
<body>
<script src="resources/eml_report_loadable_data.js"></script>
<pre class="code">
<span class="srcline"><span class="lineno"><a href="1,1" id="srcline1">  1</a></span><span class="line"><span class="keyword">function</span> [<span class="var type1" id="S2T1U3">Eds</span>, <span class="var type1" id="S3T2U4">ri</span>] = dsfield (<span class="var type1" id="S4T3U7">Einc</span>, <span class="var type1" id="S5T4U8">start_re</span>, <span class="var type1" id="S6T4U9">fin_re</span>, <span class="var type1" id="S7T5U10">sf</span>, <span class="var type1" id="S8T6U11">sp_re</span>, <span class="var type1" id="S9T2U12">surf</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="1,2" id="srcline2">  2</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,3" id="srcline3">  3</a></span><span class="line"><span class="comment">% Diffuse scattering field</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,4" id="srcline4">  4</a></span><span class="line"><span class="comment">% Refer to the paper Vittorio D. 2007</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,5" id="srcline5">  5</a></span><span class="line"><span class="comment">% start : first point</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,6" id="srcline6">  6</a></span><span class="line"><span class="comment">% fin : last point</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,7" id="srcline7">  7</a></span><span class="line"><span class="comment">% sf: scattering face </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,8" id="srcline8">  8</a></span><span class="line"><span class="comment">% sp: scattering point</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,9" id="srcline9">  9</a></span><span class="line"><span class="comment">% surf: size of element</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,10" id="srcline10"> 10</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,11" id="srcline11"> 11</a></span><span class="line"><span class="comment">% Authors: Francesco Mani &lt;francesco.mani@uclouvain.be&gt; and Mingming Gan &lt;gan@ftw.at&gt;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,12" id="srcline12"> 12</a></span><span class="line"><span class="comment">% History:  2011.10.3</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,13" id="srcline13"> 13</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,14" id="srcline14"> 14</a></span><span class="line"><span class="comment">% Updated by: Xuhong Li &lt;xuhong@ftw.at&gt;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,15" id="srcline15"> 15</a></span><span class="line"><span class="comment">% History: 2013.08.01</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,16" id="srcline16"> 16</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,17" id="srcline17"> 17</a></span><span class="line"><span class="comment">% global vnfaces Model Ar Lam Aii GAr GLam GAii Scoeff kxpol GModel GScoeff;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,18" id="srcline18"> 18</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,19" id="srcline19"> 19</a></span><span class="line"><span class="keyword">global</span> <span class="var type0" id="S10T0U14">Aii</span> <span class="var type0" id="S11T0U15">Ar</span> <span class="var type0" id="S12T0U16">kxpol</span> <span class="var type0" id="S13T0U17">Lam</span> <span class="var type0" id="S14T0U18">Model</span> <span class="var type0" id="S15T0U19">Scoeff</span> <span class="var type0" id="S16T0U20">vnfaces</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,20" id="srcline20"> 20</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,21" id="srcline21"> 21</a></span><span class="line"><span class="mxinfo " id="T3:U9"><span class="var type1" id="S17T3U23">Eout</span> = <span class="mxinfo " id="T3:U11">complex(zeros(<span class="mxinfo " id="T2:U12">3</span>,1),zeros(<span class="mxinfo " id="T2:U13">3</span>,1))</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,22" id="srcline22"> 22</a></span><span class="line"><span class="mxinfo " id="T1:U14"><span class="var type1" id="S20T1U36">Ft</span> = <span class="mxinfo " id="T1:U16"><span class="var type1" id="S17T3U38">Eout</span>'</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,23" id="srcline23"> 23</a></span><span class="line"><span class="mxinfo " id="T1:U18"><span class="var type1" id="S21T1U41">Fp</span> = <span class="var type1" id="S20T1U42">Ft</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,24" id="srcline24"> 24</a></span><span class="line"><span class="mxinfo " id="T1:U21"><span class="var type1" id="S22T1U45">ep</span> = <span class="var type1" id="S20T1U46">Ft</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,25" id="srcline25"> 25</a></span><span class="line"><span class="mxinfo " id="T1:U24"><span class="var type1" id="S23T1U49">amplEds</span> = <span class="var type1" id="S20T1U50">Ft</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,26" id="srcline26"> 26</a></span><span class="line"><span class="mxinfo " id="T4:U27"><span class="var type1" id="S24T4U53">start</span> = <span class="mxinfo " id="T4:U29">zeros(<span class="mxinfo " id="T2:U30">3</span>,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,27" id="srcline27"> 27</a></span><span class="line"><span class="mxinfo " id="T4:U31"><span class="var type1" id="S25T4U60">fin</span> = <span class="mxinfo " id="T4:U33">zeros(<span class="mxinfo " id="T2:U34">3</span>,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,28" id="srcline28"> 28</a></span><span class="line"><span class="mxinfo " id="T4:U35"><span class="var type1" id="S26T4U67">sp</span> = <span class="mxinfo " id="T4:U37">zeros(<span class="mxinfo " id="T2:U38">3</span>,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,29" id="srcline29"> 29</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,30" id="srcline30"> 30</a></span><span class="line"><span class="mxinfo " id="T2:U39"><span class="var type1" id="S27T2U74">bl</span> = <span class="mxinfo " id="T2:U41">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,31" id="srcline31"> 31</a></span><span class="line"><span class="mxinfo " id="T2:U42"><span class="var type1" id="S28T2U78">fc</span> = <span class="mxinfo " id="T2:U44">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,32" id="srcline32"> 32</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,33" id="srcline33"> 33</a></span><span class="line"><span class="mxinfo " id="T4:U45"><span class="var type1" id="S29T4U82">vnfaces_re</span> = <span class="mxinfo " id="T4:U47">zeros(<span class="mxinfo " id="T2:U48">3</span>,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,34" id="srcline34"> 34</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,35" id="srcline35"> 35</a></span><span class="line"><span class="mxinfo " id="T2:U49"><span class="var type1" id="S30T2U89">num</span> = <span class="mxinfo " id="T2:U51">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,36" id="srcline36"> 36</a></span><span class="line"><span class="mxinfo " id="T2:U52"><span class="var type1" id="S31T2U93">denom</span> = <span class="mxinfo " id="T2:U54">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,37" id="srcline37"> 37</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,38" id="srcline38"> 38</a></span><span class="line"><span class="mxinfo " id="T3:U55"><span class="mxinfo " id="T3:U56"><span class="var type1" id="S17T3U98">Eout</span>(<span class="mxinfo " id="T7:U58">1:3</span>,<span class="mxinfo " id="T8:U59">1</span>)</span> = <span class="mxinfo " id="T9:U60">complex(<span class="mxinfo " id="T2:U61">0</span>,<span class="mxinfo " id="T2:U62">0</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,39" id="srcline39"> 39</a></span><span class="line"><span class="mxinfo " id="T4:U63"><span class="mxinfo " id="T4:U64"><span class="var type1" id="S24T4U110">start</span>(<span class="mxinfo " id="T7:U66">:</span>,<span class="mxinfo " id="T8:U67">1</span>)</span> = <span class="var type1" id="S5T4U113">start_re</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,40" id="srcline40"> 40</a></span><span class="line"><span class="mxinfo " id="T4:U69"><span class="mxinfo " id="T4:U70"><span class="var type1" id="S25T4U117">fin</span>(<span class="mxinfo " id="T7:U72">:</span>,<span class="mxinfo " id="T8:U73">1</span>)</span> = <span class="var type1" id="S6T4U120">fin_re</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,41" id="srcline41"> 41</a></span><span class="line"><span class="mxinfo " id="T4:U75"><span class="mxinfo " id="T4:U76"><span class="var type1" id="S26T4U124">sp</span>(<span class="mxinfo " id="T7:U78">:</span>,<span class="mxinfo " id="T8:U79">1</span>)</span> = <span class="var type1" id="S8T6U127">sp_re</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,42" id="srcline42"> 42</a></span><span class="line"><span class="mxinfo " id="T2:U81"><span class="var type1" id="S27T2U130">bl</span> = <span class="mxinfo " id="T2:U83"><span class="var type1" id="S7T5U132">sf</span>(<span class="mxinfo " id="T8:U85">1</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,43" id="srcline43"> 43</a></span><span class="line"><span class="mxinfo " id="T2:U86"><span class="var type1" id="S28T2U136">fc</span> = <span class="mxinfo " id="T2:U88"><span class="var type1" id="S7T5U138">sf</span>(<span class="mxinfo " id="T8:U90">2</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,44" id="srcline44"> 44</a></span><span class="line"><span class="mxinfo " id="T4:U91"><span class="var type1" id="S32T4U142">si</span> = <span class="mxinfo " id="T4:U93"><span class="var type1" id="S26T4U144">sp</span>-<span class="var type1" id="S24T4U145">start</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,45" id="srcline45"> 45</a></span><span class="line"><span class="mxinfo " id="T2:U96"><span class="var type1" id="S3T2U148">ri</span> = <span class="mxinfo " id="T2:U98">norm(<span class="var type1" id="S32T4U151">si</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,46" id="srcline46"> 46</a></span><span class="line"><span class="mxinfo " id="T4:U100"><span class="var type1" id="S32T4U154">si</span> = <span class="mxinfo " id="T4:U102"><span class="mxinfo " id="T2:U103"><span class="mxinfo " id="T2:U104">1</span>/<span class="var type1" id="S3T2U158">ri</span></span>*<span class="var type1" id="S32T4U159">si</span></span></span>;    <span class="comment">% incidence unit vector</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,47" id="srcline47"> 47</a></span><span class="line"><span class="mxinfo " id="T2:U107"><span class="var type1" id="S34T2U162">dh</span> = <span class="mxinfo " id="T2:U109"><span class="mxinfo " id="T2:U110"><span class="var type1" id="S26T4U165">sp</span>(<span class="mxinfo " id="T8:U112">3</span>)</span>-<span class="mxinfo " id="T2:U113"><span class="var type1" id="S24T4U168">start</span>(<span class="mxinfo " id="T2:U115">3</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,48" id="srcline48"> 48</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,49" id="srcline49"> 49</a></span><span class="line"><span class="mxinfo " id="T2:U116"><span class="var type1" id="S35T2U172">costh</span> = <span class="mxinfo " id="T2:U118"><span class="var type1" id="S34T2U174">dh</span>/<span class="var type1" id="S3T2U175">ri</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,50" id="srcline50"> 50</a></span><span class="line"><span class="mxinfo " id="T2:U121"><span class="var type1" id="S36T2U178">sinth</span> = <span class="mxinfo " id="T2:U123">sqrt(<span class="mxinfo " id="T2:U124"><span class="mxinfo " id="T2:U125">1</span>-<span class="mxinfo " id="T2:U126"><span class="var type1" id="S35T2U184">costh</span>.^2</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,51" id="srcline51"> 51</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,52" id="srcline52"> 52</a></span><span class="line"><span class="mxinfo " id="T2:U128"><span class="var type1" id="S38T2U188">dy</span> = <span class="mxinfo " id="T2:U130"><span class="mxinfo " id="T2:U131"><span class="var type1" id="S26T4U191">sp</span>(<span class="mxinfo " id="T8:U133">2</span>)</span>-<span class="mxinfo " id="T2:U134"><span class="var type1" id="S24T4U194">start</span>(<span class="mxinfo " id="T2:U136">2</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,53" id="srcline53"> 53</a></span><span class="line"><span class="mxinfo " id="T2:U137"><span class="var type1" id="S39T2U198">dx</span> = <span class="mxinfo " id="T2:U139"><span class="mxinfo " id="T2:U140"><span class="var type1" id="S26T4U201">sp</span>(<span class="mxinfo " id="T8:U142">1</span>)</span>-<span class="mxinfo " id="T2:U143"><span class="var type1" id="S24T4U204">start</span>(<span class="mxinfo " id="T2:U145">1</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,54" id="srcline54"> 54</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,55" id="srcline55"> 55</a></span><span class="line"><span class="mxinfo " id="T2:U146"><span class="var type1" id="S40T2U208">dp</span> = <span class="mxinfo " id="T2:U148"><span class="var type1" id="S3T2U210">ri</span>*<span class="var type1" id="S36T2U211">sinth</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,56" id="srcline56"> 56</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,57" id="srcline57"> 57</a></span><span class="line"><span class="mxinfo " id="T2:U151"><span class="var type1" id="S41T2U214">sinphi</span> = <span class="mxinfo " id="T2:U153"><span class="var type1" id="S38T2U216">dy</span>/<span class="var type1" id="S40T2U217">dp</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,58" id="srcline58"> 58</a></span><span class="line"><span class="mxinfo " id="T2:U156"><span class="var type1" id="S42T2U220">cosphi</span> = <span class="mxinfo " id="T2:U158"><span class="var type1" id="S39T2U222">dx</span>/<span class="var type1" id="S40T2U223">dp</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,59" id="srcline59"> 59</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,60" id="srcline60"> 60</a></span><span class="line"><span class="mxinfo " id="T9:U161"><span class="mxinfo " id="T9:U162"><span class="var type1" id="S20T1U227">Ft</span>(<span class="mxinfo " id="T8:U164">1</span>)</span> = <span class="mxinfo " id="T9:U165">complex(<span class="mxinfo " id="T2:U166"><span class="var type1" id="S42T2U232">cosphi</span>*<span class="var type1" id="S35T2U233">costh</span></span>,<span class="mxinfo " id="T2:U169">0</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,61" id="srcline61"> 61</a></span><span class="line"><span class="mxinfo " id="T9:U170"><span class="mxinfo " id="T9:U171"><span class="var type1" id="S20T1U238">Ft</span>(<span class="mxinfo " id="T8:U173">2</span>)</span> = <span class="mxinfo " id="T9:U174">complex(<span class="mxinfo " id="T2:U175"><span class="var type1" id="S41T2U243">sinphi</span>*<span class="var type1" id="S35T2U244">costh</span></span>,<span class="mxinfo " id="T2:U178">0</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,62" id="srcline62"> 62</a></span><span class="line"><span class="mxinfo " id="T9:U179"><span class="mxinfo " id="T9:U180"><span class="var type1" id="S20T1U249">Ft</span>(<span class="mxinfo " id="T8:U182">3</span>)</span> = <span class="mxinfo " id="T9:U183">complex(<span class="mxinfo " id="T2:U184">-<span class="var type1" id="S36T2U254">sinth</span></span>,<span class="mxinfo " id="T2:U186">0</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,63" id="srcline63"> 63</a></span><span class="line"><span class="mxinfo " id="T9:U187"><span class="mxinfo " id="T9:U188"><span class="var type1" id="S21T1U259">Fp</span>(<span class="mxinfo " id="T8:U190">1</span>)</span> = <span class="mxinfo " id="T9:U191">complex(<span class="mxinfo " id="T2:U192">-<span class="var type1" id="S41T2U264">sinphi</span></span>,<span class="mxinfo " id="T2:U194">0</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,64" id="srcline64"> 64</a></span><span class="line"><span class="mxinfo " id="T9:U195"><span class="mxinfo " id="T9:U196"><span class="var type1" id="S21T1U269">Fp</span>(<span class="mxinfo " id="T8:U198">2</span>)</span> = <span class="mxinfo " id="T9:U199">complex(<span class="var type1" id="S42T2U273">cosphi</span>,<span class="mxinfo " id="T2:U201">0</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,65" id="srcline65"> 65</a></span><span class="line"><span class="mxinfo " id="T9:U202"><span class="mxinfo " id="T9:U203"><span class="var type1" id="S21T1U278">Fp</span>(<span class="mxinfo " id="T8:U205">3</span>)</span> = <span class="mxinfo " id="T9:U206">complex(0,0)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,66" id="srcline66"> 66</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,67" id="srcline67"> 67</a></span><span class="line"><span class="mxinfo " id="T9:U207"><span class="var type1" id="S43T9U286">ET</span> = <span class="mxinfo " id="T9:U209"><span class="mxinfo " id="T1:U210">conj(<span class="var type1" id="S20T1U290">Ft</span>)</span>*<span class="var type1" id="S4T3U291">Einc</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,68" id="srcline68"> 68</a></span><span class="line"><span class="mxinfo " id="T9:U213"><span class="var type1" id="S45T9U294">EH</span> = <span class="mxinfo " id="T9:U215"><span class="mxinfo " id="T1:U216">conj(<span class="var type1" id="S21T1U298">Fp</span>)</span>*<span class="var type1" id="S4T3U299">Einc</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,69" id="srcline69"> 69</a></span><span class="line"><span class="mxinfo " id="T9:U219"><span class="var type1" id="S45T9U302">EH</span> = <span class="mxinfo " id="T9:U221">(<span class="mxinfo " id="T2:U222">-1</span>)*<span class="var type1" id="S45T9U307">EH</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,70" id="srcline70"> 70</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,71" id="srcline71"> 71</a></span><span class="line"><span class="mxinfo " id="T4:U224"><span class="var type1" id="S46T4U310">ss</span> = <span class="mxinfo " id="T4:U226"><span class="var type1" id="S25T4U312">fin</span>-<span class="var type1" id="S26T4U313">sp</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,72" id="srcline72"> 72</a></span><span class="line"><span class="mxinfo " id="T2:U229"><span class="var type1" id="S47T2U316">rs</span> = <span class="mxinfo " id="T2:U231">norm(<span class="var type1" id="S46T4U319">ss</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,73" id="srcline73"> 73</a></span><span class="line"><span class="mxinfo " id="T4:U233"><span class="var type1" id="S46T4U322">ss</span> = <span class="mxinfo " id="T4:U235"><span class="mxinfo " id="T2:U236"><span class="mxinfo " id="T2:U237">1</span>/<span class="var type1" id="S47T2U326">rs</span></span>*<span class="var type1" id="S46T4U327">ss</span></span></span>; <span class="comment">% diffuse scattering unit vector</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,74" id="srcline74"> 74</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,75" id="srcline75"> 75</a></span><span class="line"><span class="mxinfo " id="T2:U240"><span class="var type1" id="S34T2U330">dh</span> = <span class="mxinfo " id="T2:U242"><span class="mxinfo " id="T2:U243"><span class="var type1" id="S25T4U333">fin</span>(<span class="mxinfo " id="T8:U245">3</span>)</span>-<span class="mxinfo " id="T2:U246"><span class="var type1" id="S26T4U336">sp</span>(<span class="mxinfo " id="T2:U248">3</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,76" id="srcline76"> 76</a></span><span class="line"><span class="mxinfo " id="T2:U249"><span class="var type1" id="S35T2U340">costh</span> = <span class="mxinfo " id="T2:U251"><span class="var type1" id="S34T2U342">dh</span>/<span class="var type1" id="S47T2U343">rs</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,77" id="srcline77"> 77</a></span><span class="line"><span class="mxinfo " id="T2:U254"><span class="var type1" id="S36T2U346">sinth</span> = <span class="mxinfo " id="T2:U256">sqrt(<span class="mxinfo " id="T2:U257"><span class="mxinfo " id="T2:U258">1</span>-<span class="mxinfo " id="T2:U259"><span class="var type1" id="S35T2U352">costh</span>.^2</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,78" id="srcline78"> 78</a></span><span class="line"><span class="mxinfo " id="T2:U261"><span class="var type1" id="S38T2U356">dy</span> = <span class="mxinfo " id="T2:U263"><span class="mxinfo " id="T2:U264">-<span class="mxinfo " id="T2:U265"><span class="var type1" id="S26T4U360">sp</span>(<span class="mxinfo " id="T8:U267">2</span>)</span></span>+<span class="mxinfo " id="T2:U268"><span class="var type1" id="S25T4U363">fin</span>(<span class="mxinfo " id="T2:U270">2</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,79" id="srcline79"> 79</a></span><span class="line"><span class="mxinfo " id="T2:U271"><span class="var type1" id="S39T2U367">dx</span> = <span class="mxinfo " id="T2:U273"><span class="mxinfo " id="T2:U274">-<span class="mxinfo " id="T2:U275"><span class="var type1" id="S26T4U371">sp</span>(<span class="mxinfo " id="T8:U277">1</span>)</span></span>+<span class="mxinfo " id="T2:U278"><span class="var type1" id="S25T4U374">fin</span>(<span class="mxinfo " id="T2:U280">1</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,80" id="srcline80"> 80</a></span><span class="line"><span class="mxinfo " id="T2:U281"><span class="var type1" id="S40T2U378">dp</span> = <span class="mxinfo " id="T2:U283"><span class="var type1" id="S47T2U380">rs</span>*<span class="var type1" id="S36T2U381">sinth</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,81" id="srcline81"> 81</a></span><span class="line"><span class="mxinfo " id="T2:U286"><span class="var type1" id="S41T2U384">sinphi</span> = <span class="mxinfo " id="T2:U288"><span class="var type1" id="S38T2U386">dy</span>/<span class="var type1" id="S40T2U387">dp</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,82" id="srcline82"> 82</a></span><span class="line"><span class="mxinfo " id="T2:U291"><span class="var type1" id="S42T2U390">cosphi</span> = <span class="mxinfo " id="T2:U293"><span class="var type1" id="S39T2U392">dx</span>/<span class="var type1" id="S40T2U393">dp</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,83" id="srcline83"> 83</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,84" id="srcline84"> 84</a></span><span class="line"><span class="mxinfo " id="T9:U296"><span class="mxinfo " id="T9:U297"><span class="var type1" id="S20T1U397">Ft</span>(<span class="mxinfo " id="T8:U299">1</span>)</span> = <span class="mxinfo " id="T9:U300">complex(<span class="mxinfo " id="T2:U301"><span class="var type1" id="S42T2U402">cosphi</span>*<span class="var type1" id="S35T2U403">costh</span></span>,<span class="mxinfo " id="T2:U304">0</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,85" id="srcline85"> 85</a></span><span class="line"><span class="mxinfo " id="T9:U305"><span class="mxinfo " id="T9:U306"><span class="var type1" id="S20T1U408">Ft</span>(<span class="mxinfo " id="T8:U308">2</span>)</span> = <span class="mxinfo " id="T9:U309">complex(<span class="mxinfo " id="T2:U310"><span class="var type1" id="S41T2U413">sinphi</span>*<span class="var type1" id="S35T2U414">costh</span></span>,<span class="mxinfo " id="T2:U313">0</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,86" id="srcline86"> 86</a></span><span class="line"><span class="mxinfo " id="T9:U314"><span class="mxinfo " id="T9:U315"><span class="var type1" id="S20T1U419">Ft</span>(<span class="mxinfo " id="T8:U317">3</span>)</span> = <span class="mxinfo " id="T9:U318">complex(<span class="mxinfo " id="T2:U319">-<span class="var type1" id="S36T2U424">sinth</span></span>,<span class="mxinfo " id="T2:U321">0</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,87" id="srcline87"> 87</a></span><span class="line"><span class="mxinfo " id="T9:U322"><span class="mxinfo " id="T9:U323"><span class="var type1" id="S21T1U429">Fp</span>(<span class="mxinfo " id="T8:U325">1</span>)</span> = <span class="mxinfo " id="T9:U326">complex(<span class="mxinfo " id="T2:U327">-<span class="var type1" id="S41T2U434">sinphi</span></span>,<span class="mxinfo " id="T2:U329">0</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,88" id="srcline88"> 88</a></span><span class="line"><span class="mxinfo " id="T9:U330"><span class="mxinfo " id="T9:U331"><span class="var type1" id="S21T1U439">Fp</span>(<span class="mxinfo " id="T8:U333">2</span>)</span> = <span class="mxinfo " id="T9:U334">complex(<span class="var type1" id="S42T2U443">cosphi</span>,<span class="mxinfo " id="T2:U336">0</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,89" id="srcline89"> 89</a></span><span class="line"><span class="mxinfo " id="T9:U337"><span class="mxinfo " id="T9:U338"><span class="var type1" id="S21T1U448">Fp</span>(<span class="mxinfo " id="T8:U340">3</span>)</span> = <span class="mxinfo " id="T9:U341">complex(0,0)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,90" id="srcline90"> 90</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,91" id="srcline91"> 91</a></span><span class="line"><span class="mxinfo " id="T1:U342"><span class="var type1" id="S48T1U456">et</span> = <span class="mxinfo " id="T1:U344"><span class="var type1" id="S20T1U458">Ft</span>*<span class="var type1" id="S43T9U459">ET</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,92" id="srcline92"> 92</a></span><span class="line"><span class="mxinfo " id="T1:U347"><span class="var type1" id="S49T1U462">eh</span> = <span class="mxinfo " id="T1:U349"><span class="var type1" id="S21T1U464">Fp</span>*<span class="var type1" id="S45T9U465">EH</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,93" id="srcline93"> 93</a></span><span class="line"><span class="mxinfo " id="T1:U352"><span class="var type1" id="S50T1U468">ei</span> = <span class="mxinfo " id="T1:U354"><span class="var type1" id="S48T1U470">et</span>+<span class="var type1" id="S49T1U471">eh</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,94" id="srcline94"> 94</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,95" id="srcline95"> 95</a></span><span class="line"><span class="mxinfo " id="T4:U357"><span class="mxinfo " id="T4:U358"><span class="var type1" id="S29T4U475">vnfaces_re</span>(<span class="mxinfo " id="T7:U360">:</span>,<span class="mxinfo " id="T8:U361">1</span>)</span> = <span class="mxinfo " id="T10:U362"><span class="var type1" id="S16T11U479">vnfaces</span>(<span class="var type1" id="S27T2U480">bl</span>,<span class="var type1" id="S28T2U481">fc</span>,<span class="mxinfo " id="T7:U366">:</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,96" id="srcline96"> 96</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,97" id="srcline97"> 97</a></span><span class="line"><span class="mxinfo " id="T2:U367"><span class="var type1" id="S51T2U485">costi</span> = <span class="mxinfo " id="T2:U369">-(<span class="mxinfo " id="T2:U370"><span class="mxinfo " id="T6:U371"><span class="var type1" id="S29T4U490">vnfaces_re</span>'</span>*<span class="var type1" id="S32T4U491">si</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,98" id="srcline98"> 98</a></span><span class="line"><span class="mxinfo " id="T4:U374"><span class="var type1" id="S52T4U494">vtemp</span> = <span class="mxinfo " id="T4:U376"><span class="mxinfo " id="T2:U377"><span class="mxinfo " id="T2:U378">2</span>*<span class="var type1" id="S51T2U498">costi</span></span>*<span class="var type1" id="S29T4U499">vnfaces_re</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,99" id="srcline99"> 99</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,100" id="srcline100">100</a></span><span class="line"><span class="mxinfo " id="T4:U381"><span class="var type1" id="S53T4U502">sr</span> = <span class="mxinfo " id="T4:U383"><span class="var type1" id="S32T4U504">si</span>+<span class="var type1" id="S52T4U505">vtemp</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,101" id="srcline101">101</a></span><span class="line"><span class="mxinfo " id="T2:U386"><span class="var type1" id="S54T2U508">rr</span> = <span class="mxinfo " id="T2:U388">norm(<span class="var type1" id="S53T4U511">sr</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,102" id="srcline102">102</a></span><span class="line"><span class="mxinfo " id="T4:U390"><span class="var type1" id="S53T4U514">sr</span> = <span class="mxinfo " id="T4:U392"><span class="mxinfo " id="T2:U393"><span class="mxinfo " id="T2:U394">1</span>/<span class="var type1" id="S54T2U518">rr</span></span>*<span class="var type1" id="S53T4U519">sr</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,103" id="srcline103">103</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,104" id="srcline104">104</a></span><span class="line"><span class="mxinfo " id="T2:U397"><span class="var type1" id="S55T2U522">costs</span> = <span class="mxinfo " id="T2:U399"><span class="mxinfo " id="T6:U400"><span class="var type1" id="S29T4U525">vnfaces_re</span>'</span>*<span class="var type1" id="S46T4U526">ss</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,105" id="srcline105">105</a></span><span class="line"><span class="mxinfo " id="T2:U403"><span class="var type1" id="S56T2U529">cosfr</span> = <span class="mxinfo " id="T2:U405"><span class="mxinfo " id="T6:U406"><span class="var type1" id="S46T4U532">ss</span>'</span>*<span class="var type1" id="S53T4U533">sr</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,106" id="srcline106">106</a></span><span class="line"><span class="mxinfo " id="T4:U409"><span class="var type1" id="S57T4U536">nsi</span> = <span class="mxinfo " id="T4:U411">-<span class="var type1" id="S32T4U538">si</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,107" id="srcline107">107</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,108" id="srcline108">108</a></span><span class="line"><span class="mxinfo " id="T2:U413"><span class="var type1" id="S58T2U541">cosfi</span> = <span class="mxinfo " id="T2:U415"><span class="mxinfo " id="T6:U416"><span class="var type1" id="S46T4U544">ss</span>'</span>*<span class="var type1" id="S57T4U545">nsi</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,109" id="srcline109">109</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,110" id="srcline110">110</a></span><span class="line"><span class="comment">% if ((bl ~= 0) &amp;&amp; (Model(bl) == 1)) || ((bl == 0) &amp;&amp; (GModel == 1))    % choice of the diffuse scattering model</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,111" id="srcline111">111</a></span><span class="line"><span class="keyword">if</span> (<span class="mxinfo " id="T12:U419"><span class="mxinfo " id="T2:U420"><span class="var type1" id="S14T13U551">Model</span>(<span class="var type1" id="S27T2U552">bl</span>)</span> == <span class="mxinfo " id="T2:U423">1</span></span>) <span class="comment">% choice of the diffuse scattering model</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,112" id="srcline112">112</a></span><span class="line">    <span class="mxinfo " id="T2:U424"><span class="var type1" id="S31T2U556">denom</span> = <span class="mxinfo " id="T2:U426">pi</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,113" id="srcline113">113</a></span><span class="line">    <span class="mxinfo " id="T2:U427"><span class="var type1" id="S30T2U561">num</span> = <span class="var type1" id="S55T2U562">costs</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,114" id="srcline114">114</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,115" id="srcline115">115</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,116" id="srcline116">116</a></span><span class="line"><span class="comment">% if ((bl ~= 0) &amp;&amp; (Model(bl) == 2))</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,117" id="srcline117">117</a></span><span class="line"><span class="keyword">if</span> (<span class="mxinfo " id="T12:U430"><span class="mxinfo " id="T2:U431"><span class="var type1" id="S14T13U568">Model</span>(<span class="var type1" id="S27T2U569">bl</span>)</span> == <span class="mxinfo " id="T2:U434">2</span></span>)</span></span>
<span class="srcline"><span class="lineno"><a href="1,118" id="srcline118">118</a></span><span class="line">    <span class="mxinfo " id="T2:U435"><span class="var type1" id="S31T2U573">denom</span> = <span class="mxinfo " id="T2:U437"><span class="fcn" id="F133N2:B575">Falpha</span>(<span class="mxinfo " id="T2:U438"><span class="var type1" id="S11T13U577">Ar</span>(<span class="var type1" id="S27T2U578">bl</span>)</span>,<span class="var type1" id="S51T2U579">costi</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,119" id="srcline119">119</a></span><span class="line">    <span class="mxinfo " id="T2:U442"><span class="var type1" id="S30T2U582">num</span> = <span class="mxinfo " id="T2:U444"><span class="fcn" id="F134N10:B584">lobe</span>(<span class="var type1" id="S56T2U585">cosfr</span>,<span class="mxinfo " id="T2:U446"><span class="var type1" id="S11T13U587">Ar</span>(<span class="var type1" id="S27T2U588">bl</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,120" id="srcline120">120</a></span><span class="line"><span class="comment">% elseif ((bl == 0) &amp;&amp; (GModel == 2))</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,121" id="srcline121">121</a></span><span class="line"><span class="comment">%     denom = Falpha(GAr,costi);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,122" id="srcline122">122</a></span><span class="line"><span class="comment">%     num = lobe(cosfr,GAr);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,123" id="srcline123">123</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,124" id="srcline124">124</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,125" id="srcline125">125</a></span><span class="line"><span class="comment">% if ((bl ~= 0) &amp;&amp; (Model(bl) == 3))</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,126" id="srcline126">126</a></span><span class="line"><span class="keyword">if</span> (<span class="mxinfo " id="T12:U449"><span class="mxinfo " id="T2:U450"><span class="var type1" id="S14T13U594">Model</span>(<span class="var type1" id="S27T2U595">bl</span>)</span> == <span class="mxinfo " id="T2:U453">3</span></span>)</span></span>
<span class="srcline"><span class="lineno"><a href="1,127" id="srcline127">127</a></span><span class="line">    <span class="mxinfo " id="T2:U454"><span class="var type1" id="S31T2U599">denom</span> = <span class="mxinfo " id="T2:U456"><span class="mxinfo " id="T2:U457"><span class="mxinfo " id="T2:U458"><span class="var type1" id="S13T13U603">Lam</span>(<span class="var type1" id="S27T2U604">bl</span>)</span>*<span class="mxinfo " id="T2:U461"><span class="fcn" id="F133N2:B606">Falpha</span>(<span class="mxinfo " id="T2:U462"><span class="var type1" id="S11T13U608">Ar</span>(<span class="var type1" id="S27T2U609">bl</span>)</span>,<span class="var type1" id="S51T2U610">costi</span>)</span></span>+<span class="mxinfo " id="T2:U466">(<span class="mxinfo " id="T2:U467"><span class="mxinfo " id="T2:U468">1</span>-<span class="mxinfo " id="T2:U469"><span class="var type1" id="S13T13U616">Lam</span>(<span class="var type1" id="S27T2U617">bl</span>)</span></span>)*<span class="mxinfo " id="T2:U472"><span class="fcn" id="F133N2:B619">Falpha</span>(<span class="mxinfo " id="T2:U473"><span class="var type1" id="S10T13U621">Aii</span>(<span class="var type1" id="S27T2U622">bl</span>)</span>,<span class="var type1" id="S51T2U623">costi</span>)</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,128" id="srcline128">128</a></span><span class="line">    <span class="mxinfo " id="T2:U477"><span class="var type1" id="S30T2U626">num</span>   = <span class="mxinfo " id="T2:U479"><span class="mxinfo " id="T2:U480"><span class="mxinfo " id="T2:U481"><span class="var type1" id="S13T13U630">Lam</span>(<span class="var type1" id="S27T2U631">bl</span>)</span>*<span class="mxinfo " id="T2:U484"><span class="fcn" id="F134N10:B633">lobe</span>(<span class="var type1" id="S56T2U634">cosfr</span>,<span class="mxinfo " id="T2:U486"><span class="var type1" id="S11T13U636">Ar</span>(<span class="var type1" id="S27T2U637">bl</span>)</span>)</span></span>+<span class="mxinfo " id="T2:U489">(<span class="mxinfo " id="T2:U490"><span class="mxinfo " id="T2:U491">1</span>-<span class="mxinfo " id="T2:U492"><span class="var type1" id="S13T13U643">Lam</span>(<span class="var type1" id="S27T2U644">bl</span>)</span></span>)*<span class="mxinfo " id="T2:U495"><span class="fcn" id="F133N2:B646">Falpha</span>(<span class="mxinfo " id="T2:U496"><span class="var type1" id="S10T13U648">Aii</span>(<span class="var type1" id="S27T2U649">bl</span>)</span>,<span class="var type1" id="S58T2U650">cosfi</span>)</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,129" id="srcline129">129</a></span><span class="line"><span class="comment">% elseif ((bl == 0) &amp;&amp; (GModel == 3))</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,130" id="srcline130">130</a></span><span class="line"><span class="comment">%     denom = GLam*Falpha(GAr,costi)+(1-GLam)*Falpha(GAii,costi);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,131" id="srcline131">131</a></span><span class="line"><span class="comment">%     num = GLam*lobe(cosfr,GAr)+(1-GLam)*Falpha(GAii,cosfi);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,132" id="srcline132">132</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,133" id="srcline133">133</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,134" id="srcline134">134</a></span><span class="line"><span class="mxinfo " id="T2:U500"><span class="var type1" id="S62T2U653">radic</span>     = <span class="mxinfo " id="T2:U502">sqrt(<span class="mxinfo " id="T2:U503">(<span class="mxinfo " id="T2:U504"><span class="mxinfo " id="T2:U505"><span class="var type1" id="S51T2U660">costi</span>*<span class="var type1" id="S30T2U661">num</span></span>*<span class="var type1" id="S9T2U662">surf</span></span>)/<span class="var type1" id="S31T2U663">denom</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,135" id="srcline135">135</a></span><span class="line"><span class="mxinfo " id="T4:U510"><span class="var type1" id="S63T4U666">frp</span>       = <span class="mxinfo " id="T4:U512"><span class="var type1" id="S26T4U668">sp</span>+<span class="var type1" id="S53T4U669">sr</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,136" id="srcline136">136</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,137" id="srcline137">137</a></span><span class="line"><span class="mxinfo " id="T2:U515"><span class="var type1" id="S64T2U672">Re2</span>       = <span class="mxinfo " id="T2:U517">reshape(<span class="var type1" id="S27T2U675">bl</span>,1,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,138" id="srcline138">138</a></span><span class="line"><span class="mxinfo " id="T4:U519"><span class="var type1" id="S66T4U680">Re3</span>       = <span class="mxinfo " id="T4:U521">reshape(<span class="var type1" id="S24T4U683">start</span>,3,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,139" id="srcline139">139</a></span><span class="line"><span class="mxinfo " id="T4:U523"><span class="var type1" id="S67T4U688">Re4</span>       = <span class="mxinfo " id="T4:U525">reshape(<span class="var type1" id="S63T4U691">frp</span>,3,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,140" id="srcline140">140</a></span><span class="line"><span class="mxinfo " id="T14:U527"><span class="var type1" id="S68T14U696">Re5</span>       = <span class="mxinfo " id="T14:U529">reshape(<span class="var type1" id="S26T4U699">sp</span>,1,1,1,3)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,141" id="srcline141">141</a></span><span class="line"><span class="mxinfo " id="T4:U531"><span class="var type1" id="S69T4U706">vn_temp</span>   = <span class="mxinfo " id="T4:U533">reshape(<span class="mxinfo " id="T10:U534"><span class="var type1" id="S16T11U710">vnfaces</span>(<span class="var type1" id="S27T2U711">bl</span>,<span class="var type1" id="S28T2U712">fc</span>,<span class="mxinfo " id="T7:U538">:</span>)</span>,3,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,142" id="srcline142">142</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,143" id="srcline143">143</a></span><span class="line"><span class="comment">% Eout      = RefField(-1,Re2,Re3,Re4,Re5,vn_temp,Einc);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,144" id="srcline144">144</a></span><span class="line"><span class="comment">% Eout = RefField(-1,bl,start,frp,sp,vn_temp,Einc);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,145" id="srcline145">145</a></span><span class="line">[<span class="var type1" id="S17T3U719">Eout</span>,<span class="mxinfo " id="T9:U540">~</span>,<span class="mxinfo " id="T9:U541">~</span>] = <span class="fcn" id="F265N3:B723">RefFieldUP</span>(<span class="mxinfo " id="T2:U542">-1</span>,<span class="var type1" id="S27T2U726">bl</span>,<span class="var type1" id="S24T4U727">start</span>,<span class="var type1" id="S63T4U728">frp</span>,<span class="var type1" id="S26T4U729">sp</span>,<span class="var type1" id="S69T4U730">vn_temp</span>,<span class="var type1" id="S4T3U731">Einc</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,146" id="srcline146">146</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,147" id="srcline147">147</a></span><span class="line"><span class="mxinfo " id="T4:U549"><span class="var type1" id="S71T4U734">amplEo</span>    = <span class="mxinfo " id="T4:U551">abs(<span class="var type1" id="S17T3U737">Eout</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,148" id="srcline148">148</a></span><span class="line"><span class="mxinfo " id="T4:U553"><span class="var type1" id="S73T4U740">amplEi</span>    = <span class="mxinfo " id="T4:U555">abs(<span class="var type1" id="S4T3U743">Einc</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,149" id="srcline149">149</a></span><span class="line"><span class="mxinfo " id="T2:U557"><span class="var type1" id="S74T2U746">rflcoeff</span>  = <span class="mxinfo " id="T2:U559"><span class="mxinfo " id="T2:U560">norm(<span class="var type1" id="S71T4U750">amplEo</span>)</span>/<span class="mxinfo " id="T2:U562">norm(<span class="var type1" id="S73T4U753">amplEi</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,150" id="srcline150">150</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,151" id="srcline151">151</a></span><span class="line"><span class="comment">% if (bl ~= 0)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,152" id="srcline152">152</a></span><span class="line"><span class="mxinfo " id="T1:U564"><span class="var type1" id="S23T1U756">amplEds</span>   = <span class="mxinfo " id="T1:U566"><span class="mxinfo " id="T2:U567"><span class="mxinfo " id="T2:U568"><span class="var type1" id="S62T2U760">radic</span>*<span class="mxinfo " id="T2:U570"><span class="var type1" id="S15T13U762">Scoeff</span>(<span class="var type1" id="S27T2U763">bl</span>)</span></span>*<span class="var type1" id="S74T2U764">rflcoeff</span></span>*<span class="var type1" id="S50T1U765">ei</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,153" id="srcline153">153</a></span><span class="line"><span class="comment">% elseif (bl == 0)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,154" id="srcline154">154</a></span><span class="line"><span class="comment">%     amplEds = radic*GScoeff*rflcoeff*ei;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,155" id="srcline155">155</a></span><span class="line"><span class="comment">% end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,156" id="srcline156">156</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,157" id="srcline157">157</a></span><span class="line"><span class="mxinfo " id="T6:U575"><span class="var type1" id="S75T6U768">ample</span>     = <span class="mxinfo " id="T6:U577">abs(<span class="var type1" id="S23T1U771">amplEds</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,158" id="srcline158">158</a></span><span class="line"><span class="mxinfo " id="T2:U579"><span class="var type1" id="S76T2U774">normeds</span>   = <span class="mxinfo " id="T2:U581">norm(<span class="var type1" id="S75T6U777">ample</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,159" id="srcline159">159</a></span><span class="line"><span class="mxinfo " id="T1:U583"><span class="var type1" id="S77T1U780">eds</span>       = <span class="mxinfo " id="T1:U585"><span class="mxinfo " id="T2:U586"><span class="mxinfo " id="T2:U587">1</span>/<span class="var type1" id="S76T2U784">normeds</span></span>*<span class="var type1" id="S23T1U785">amplEds</span></span></span>; <span class="comment">% co-polarization</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,160" id="srcline160">160</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,161" id="srcline161">161</a></span><span class="line"><span class="mxinfo " id="T9:U590"><span class="mxinfo " id="T9:U591"><span class="var type1" id="S22T1U789">ep</span>(<span class="mxinfo " id="T8:U593">1</span>)</span>     = <span class="mxinfo " id="T9:U594"><span class="mxinfo " id="T9:U595"><span class="mxinfo " id="T2:U596"><span class="var type1" id="S46T4U794">ss</span>(<span class="mxinfo " id="T8:U598">2</span>)</span>*<span class="mxinfo " id="T9:U599"><span class="var type1" id="S77T1U797">eds</span>(<span class="mxinfo " id="T8:U601">3</span>)</span></span>-<span class="mxinfo " id="T9:U602"><span class="mxinfo " id="T2:U603"><span class="var type1" id="S46T4U801">ss</span>(<span class="mxinfo " id="T8:U605">3</span>)</span>*<span class="mxinfo " id="T9:U606"><span class="var type1" id="S77T1U804">eds</span>(<span class="mxinfo " id="T8:U608">2</span>)</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,162" id="srcline162">162</a></span><span class="line"><span class="mxinfo " id="T9:U609"><span class="mxinfo " id="T9:U610"><span class="var type1" id="S22T1U809">ep</span>(<span class="mxinfo " id="T8:U612">2</span>)</span>     = <span class="mxinfo " id="T9:U613"><span class="mxinfo " id="T9:U614"><span class="mxinfo " id="T2:U615"><span class="var type1" id="S46T4U814">ss</span>(<span class="mxinfo " id="T8:U617">3</span>)</span>*<span class="mxinfo " id="T9:U618"><span class="var type1" id="S77T1U817">eds</span>(<span class="mxinfo " id="T8:U620">1</span>)</span></span>-<span class="mxinfo " id="T9:U621"><span class="mxinfo " id="T2:U622"><span class="var type1" id="S46T4U821">ss</span>(<span class="mxinfo " id="T8:U624">1</span>)</span>*<span class="mxinfo " id="T9:U625"><span class="var type1" id="S77T1U824">eds</span>(<span class="mxinfo " id="T8:U627">3</span>)</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,163" id="srcline163">163</a></span><span class="line"><span class="mxinfo " id="T9:U628"><span class="mxinfo " id="T9:U629"><span class="var type1" id="S22T1U829">ep</span>(<span class="mxinfo " id="T8:U631">3</span>)</span>     = <span class="mxinfo " id="T9:U632"><span class="mxinfo " id="T9:U633"><span class="mxinfo " id="T2:U634"><span class="var type1" id="S46T4U834">ss</span>(<span class="mxinfo " id="T8:U636">1</span>)</span>*<span class="mxinfo " id="T9:U637"><span class="var type1" id="S77T1U837">eds</span>(<span class="mxinfo " id="T8:U639">2</span>)</span></span>-<span class="mxinfo " id="T9:U640"><span class="mxinfo " id="T2:U641"><span class="var type1" id="S46T4U841">ss</span>(<span class="mxinfo " id="T8:U643">2</span>)</span>*<span class="mxinfo " id="T9:U644"><span class="var type1" id="S77T1U844">eds</span>(<span class="mxinfo " id="T8:U646">1</span>)</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,164" id="srcline164">164</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,165" id="srcline165">165</a></span><span class="line"><span class="mxinfo " id="T6:U647"><span class="var type1" id="S75T6U848">ample</span>     = <span class="mxinfo " id="T6:U649">abs(<span class="var type1" id="S22T1U851">ep</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,166" id="srcline166">166</a></span><span class="line"><span class="mxinfo " id="T2:U651"><span class="var type1" id="S78T2U854">normep</span>    = <span class="mxinfo " id="T2:U653">norm(<span class="var type1" id="S75T6U857">ample</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,167" id="srcline167">167</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,168" id="srcline168">168</a></span><span class="line"><span class="mxinfo " id="T1:U655"><span class="var type1" id="S22T1U860">ep</span>        = <span class="mxinfo " id="T1:U657"><span class="mxinfo " id="T2:U658"><span class="mxinfo " id="T2:U659">1</span>/<span class="var type1" id="S78T2U864">normep</span></span>*<span class="var type1" id="S22T1U865">ep</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,169" id="srcline169">169</a></span><span class="line"><span class="mxinfo " id="T6:U662"><span class="var type1" id="S79T6U868">real_re</span>   = <span class="mxinfo " id="T6:U664">-<span class="mxinfo " id="T6:U665">real(<span class="var type1" id="S22T1U872">ep</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,170" id="srcline170">170</a></span><span class="line"><span class="mxinfo " id="T1:U667"><span class="var type1" id="S22T1U875">ep</span>        = <span class="mxinfo " id="T1:U669">complex(<span class="var type1" id="S79T6U878">real_re</span>,<span class="mxinfo " id="T6:U671">imag(<span class="var type1" id="S22T1U881">ep</span>)</span>)</span></span>; <span class="comment">% cross-polarization</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,171" id="srcline171">171</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,172" id="srcline172">172</a></span><span class="line"><span class="mxinfo " id="T1:U673"><span class="var type1" id="S82T1U884">Eco</span>       = <span class="mxinfo " id="T1:U675"><span class="mxinfo " id="T2:U676"><span class="var type1" id="S76T2U887">normeds</span>*<span class="mxinfo " id="T2:U678">sqrt(<span class="mxinfo " id="T2:U679"><span class="mxinfo " id="T2:U680">1</span>-<span class="var type1" id="S12T2U892">kxpol</span></span>)</span></span>*<span class="var type1" id="S77T1U893">eds</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,173" id="srcline173">173</a></span><span class="line"><span class="mxinfo " id="T1:U683"><span class="var type1" id="S83T1U896">Exp</span>       = <span class="mxinfo " id="T1:U685"><span class="mxinfo " id="T2:U686"><span class="var type1" id="S76T2U899">normeds</span>*<span class="mxinfo " id="T2:U688">sqrt(<span class="var type1" id="S12T2U902">kxpol</span>)</span></span>*<span class="var type1" id="S22T1U903">ep</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,174" id="srcline174">174</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,175" id="srcline175">175</a></span><span class="line"><span class="mxinfo " id="T1:U691"><span class="var type1" id="S23T1U906">amplEds</span>   = <span class="mxinfo " id="T1:U693"><span class="var type1" id="S82T1U908">Eco</span>+<span class="var type1" id="S83T1U909">Exp</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,176" id="srcline176">176</a></span><span class="line"><span class="mxinfo " id="T9:U696"><span class="var type1" id="S84T9U912">cas</span>       = <span class="mxinfo " id="T9:U698">exp(<span class="mxinfo " id="T9:U699"><span class="mxinfo " id="T9:U700">1j*2*pi</span>*<span class="mxinfo " id="T2:U701">rand(1)</span></span>)</span></span>; <span class="comment">% random phase</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,177" id="srcline177">177</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,178" id="srcline178">178</a></span><span class="line"><span class="mxinfo " id="T1:U702"><span class="var type1" id="S2T1U927">Eds</span>       = <span class="mxinfo " id="T1:U704"><span class="var type1" id="S23T1U929">amplEds</span>*<span class="var type1" id="S84T9U930">cas</span></span></span>;</span></span>
</pre>
</body>
</html>
