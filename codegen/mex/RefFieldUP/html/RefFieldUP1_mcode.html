<!-- saved from url=(0014)about:internet -->
<html>
<body>
<script src="resources/eml_report_loadable_data.js"></script>
<pre class="code">
<span class="srcline"><span class="lineno"><a href="1,1" id="srcline1"> 1</a></span><span class="line"><span class="keyword">function</span> [<span class="var type1" id="S2T1U3">Eout</span>, <span class="var type1" id="S3T2U4">Rt</span>, <span class="var type1" id="S4T2U5">Rh</span>] = RefFieldUP (<span class="var type1" id="S5T3U8">pblo</span>, <span class="var type1" id="S6T3U9">blo</span>, <span class="var type1" id="S7T4U10">E_re</span>, <span class="var type1" id="S8T4U11">R_re</span>, <span class="var type1" id="S9T5U12">qr_re</span>, <span class="var type1" id="S10T4U13">n_re</span>, <span class="var type1" id="S11T1U14">Ein</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="1,2" id="srcline2"> 2</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,3" id="srcline3"> 3</a></span><span class="line"><span class="comment">% Calculates the reflected field</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,4" id="srcline4"> 4</a></span><span class="line"><span class="comment">% blo : block number for which the reflected field is evaluated</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,5" id="srcline5"> 5</a></span><span class="line"><span class="comment">% E : transmitter position</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,6" id="srcline6"> 6</a></span><span class="line"><span class="comment">% R : receiver position</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,7" id="srcline7"> 7</a></span><span class="line"><span class="comment">% qr : reflection point</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,8" id="srcline8"> 8</a></span><span class="line"><span class="comment">% n : ext. norm.</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,9" id="srcline9"> 9</a></span><span class="line"><span class="comment">% Ein : incident field</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,10" id="srcline10">10</a></span><span class="line"><span class="comment">% Eout : field at the observation point (R)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,11" id="srcline11">11</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,12" id="srcline12">12</a></span><span class="line"><span class="comment">% Authors: Francesco Mani &lt;francesco.mani@uclouvain.be&gt; and Mingming Gan &lt;gan@ftw.at&gt;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,13" id="srcline13">13</a></span><span class="line"><span class="comment">% History: 2011.9.26</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,14" id="srcline14">14</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,15" id="srcline15">15</a></span><span class="line"><span class="comment">% Updated by: Xuhong Li &lt;xuhong@ftw.at&gt;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,16" id="srcline16">16</a></span><span class="line"><span class="comment">% History: 2013.08.01</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,17" id="srcline17">17</a></span><span class="line"><span class="comment">%          2014.02.06(save the reflection coefficients)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,18" id="srcline18">18</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,19" id="srcline19">19</a></span><span class="line"><span class="comment">% global CEP eta GCEP Geta GRcoeff K Rcoeff vnfaces wedges;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,20" id="srcline20">20</a></span><span class="line"><span class="keyword">global</span> <span class="var type0" id="S12T0U16">CEP</span> <span class="var type0" id="S13T0U17">eta</span> <span class="var type0" id="S14T0U18">K</span> <span class="var type0" id="S15T0U19">Rcoeff</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,21" id="srcline21">21</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,22" id="srcline22">22</a></span><span class="line"><span class="comment">%%%%%%%%% Incident wave coordinate system calculation : eti &amp; ehi %%%%%%%%%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,23" id="srcline23">23</a></span><span class="line"><span class="comment">% eti is the perpendicular vector to the incident plane</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,24" id="srcline24">24</a></span><span class="line"><span class="comment">% ehi is the parallel vector to the incident plane</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,25" id="srcline25">25</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,26" id="srcline26">26</a></span><span class="line"><span class="mxinfo " id="T4:U11"><span class="var type1" id="S16T4U22">vr</span>                  = <span class="mxinfo " id="T4:U13">zeros(<span class="mxinfo " id="T3:U14">3</span>,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,27" id="srcline27">27</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,28" id="srcline28">28</a></span><span class="line"><span class="mxinfo " id="T4:U15"><span class="var type1" id="S18T4U29">E</span>                   = <span class="mxinfo " id="T4:U17">reshape(<span class="var type1" id="S7T4U32">E_re</span>,3,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,29" id="srcline29">29</a></span><span class="line"><span class="mxinfo " id="T4:U19"><span class="var type1" id="S20T4U37">qr</span>                  = <span class="mxinfo " id="T4:U21">reshape(<span class="var type1" id="S9T5U40">qr_re</span>,3,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,30" id="srcline30">30</a></span><span class="line"><span class="mxinfo " id="T4:U23"><span class="var type1" id="S21T4U45">n</span>                   = <span class="mxinfo " id="T4:U25">reshape(<span class="var type1" id="S10T4U48">n_re</span>,3,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,31" id="srcline31">31</a></span><span class="line"><span class="mxinfo " id="T4:U27"><span class="var type1" id="S22T4U53">R</span>                   = <span class="mxinfo " id="T4:U29">reshape(<span class="var type1" id="S8T4U56">R_re</span>,3,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,32" id="srcline32">32</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,33" id="srcline33">33</a></span><span class="line"><span class="mxinfo " id="T4:U31"><span class="var type1" id="S23T4U61">vi</span>                  = <span class="mxinfo " id="T4:U33"><span class="var type1" id="S20T4U63">qr</span>-<span class="var type1" id="S18T4U64">E</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,34" id="srcline34">34</a></span><span class="line"><span class="mxinfo " id="T3:U36"><span class="var type1" id="S24T3U67">di</span>                  = <span class="mxinfo " id="T3:U38">norm(<span class="mxinfo " id="T4:U39"><span class="var type1" id="S20T4U71">qr</span>-<span class="var type1" id="S18T4U72">E</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,35" id="srcline35">35</a></span><span class="line"><span class="mxinfo " id="T4:U42"><span class="var type1" id="S23T4U75">vi</span>                  = <span class="mxinfo " id="T4:U44"><span class="mxinfo " id="T3:U45"><span class="mxinfo " id="T3:U46">1</span>/<span class="var type1" id="S24T3U79">di</span></span>*<span class="var type1" id="S23T4U80">vi</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,36" id="srcline36">36</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,37" id="srcline37">37</a></span><span class="line"><span class="mxinfo " id="T4:U49"><span class="mxinfo " id="T4:U50"><span class="var type1" id="S16T4U84">vr</span>(<span class="mxinfo " id="T6:U52">:</span>,<span class="mxinfo " id="T7:U53">1</span>)</span>             = <span class="mxinfo " id="T4:U54"><span class="var type1" id="S22T4U88">R</span>-<span class="var type1" id="S20T4U89">qr</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,38" id="srcline38">38</a></span><span class="line"><span class="mxinfo " id="T3:U57"><span class="var type1" id="S26T3U92">dr</span>                  = <span class="mxinfo " id="T3:U59">norm(<span class="mxinfo " id="T4:U60"><span class="var type1" id="S22T4U96">R</span>-<span class="var type1" id="S20T4U97">qr</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,39" id="srcline39">39</a></span><span class="line"><span class="mxinfo " id="T4:U63"><span class="var type1" id="S16T4U100">vr</span>                  = <span class="mxinfo " id="T4:U65"><span class="mxinfo " id="T3:U66"><span class="mxinfo " id="T3:U67">1</span>/<span class="var type1" id="S26T3U104">dr</span></span>*<span class="var type1" id="S16T4U105">vr</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,40" id="srcline40">40</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,41" id="srcline41">41</a></span><span class="line"><span class="mxinfo " id="T4:U70"><span class="var type1" id="S27T4U108">eti</span>                 = <span class="mxinfo " id="T4:U72">cross(<span class="var type1" id="S23T4U111">vi</span>,<span class="var type1" id="S21T4U112">n</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,42" id="srcline42">42</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,43" id="srcline43">43</a></span><span class="line"><span class="mxinfo " id="T2:U75"><span class="var type1" id="S29T2U115">csfi2</span>               = <span class="mxinfo " id="T2:U77">complex(<span class="mxinfo " id="T3:U78"><span class="mxinfo " id="T3:U79">norm(<span class="var type1" id="S27T4U121">eti</span>)</span>^2</span>,<span class="mxinfo " id="T3:U81">0</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,44" id="srcline44">44</a></span><span class="line"><span class="mxinfo " id="T2:U82"><span class="var type1" id="S31T2U126">ccfi</span>                = <span class="mxinfo " id="T2:U84">complex(<span class="mxinfo " id="T3:U85">max(<span class="mxinfo " id="T3:U86">0</span>,<span class="mxinfo " id="T3:U87">real(<span class="mxinfo " id="T2:U88">sqrt(<span class="mxinfo " id="T2:U89"><span class="mxinfo " id="T3:U90">1</span>-<span class="var type1" id="S29T2U138">csfi2</span></span>)</span>)</span>)</span>,<span class="mxinfo " id="T3:U92">0</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,45" id="srcline45">45</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,46" id="srcline46">46</a></span><span class="line"><span class="comment">% if (norm(eti) &lt;= 1.0e-6) % if incident wave is normal to the surface, i.e. (cross-product = 0) &lt;=&gt; (theta_inc = 0)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,47" id="srcline47">47</a></span><span class="line">    [<span class="var type1" id="S27T4U143">eti</span>,<span class="var type1" id="S35T4U144">ehi</span>]       = <span class="fcn" id="F124N3:B146">cart2rayfixed</span>(<span class="var type1" id="S23T4U147">vi</span>); <span class="comment">% (OR): eti -&gt; unitary parallel vector</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,48" id="srcline48">48</a></span><span class="line"><span class="comment">% end                                      %       ehi -&gt; unitary perpendicular vector</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,49" id="srcline49">49</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,50" id="srcline50">50</a></span><span class="line"><span class="mxinfo " id="T4:U96"><span class="var type1" id="S37T4U150">ehr</span>                 = <span class="mxinfo " id="T4:U98">cross(<span class="var type1" id="S27T4U153">eti</span>,<span class="var type1" id="S16T4U154">vr</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,51" id="srcline51">51</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,52" id="srcline52">52</a></span><span class="line"><span class="comment">%%%%%%%%%%%%%%%%% E components in the SW-fixed coordinate system %%%%%%%%%%%%%%%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,53" id="srcline53">53</a></span><span class="line"><span class="mxinfo " id="T2:U101"><span class="var type1" id="S38T2U157">coEh</span>                = <span class="mxinfo " id="T2:U103"><span class="mxinfo " id="T8:U104"><span class="var type1" id="S35T4U160">ehi</span>'</span>*<span class="var type1" id="S11T1U161">Ein</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,54" id="srcline54">54</a></span><span class="line"><span class="mxinfo " id="T2:U107"><span class="var type1" id="S39T2U164">coEt</span>                = <span class="mxinfo " id="T2:U109"><span class="mxinfo " id="T8:U110"><span class="var type1" id="S27T4U167">eti</span>'</span>*<span class="var type1" id="S11T1U168">Ein</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,55" id="srcline55">55</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,56" id="srcline56">56</a></span><span class="line"><span class="keyword">if</span> (<span class="mxinfo " id="T9:U113"><span class="mxinfo " id="T3:U114"><span class="var type1" id="S12T10U174">CEP</span>(<span class="var type1" id="S6T3U175">blo</span>)</span> == <span class="mxinfo " id="T3:U117">1</span></span>)</span></span>
<span class="srcline"><span class="lineno"><a href="1,57" id="srcline57">57</a></span><span class="line">    <span class="mxinfo " id="T2:U118"><span class="var type1" id="S3T2U179">Rt</span>              = <span class="mxinfo " id="T2:U120">complex(<span class="mxinfo " id="T3:U121">-<span class="mxinfo " id="T3:U122">1</span></span>,<span class="mxinfo " id="T3:U123">0</span>)</span></span>; <span class="comment">% -&gt; perpendicular polarization coefficient</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,58" id="srcline58">58</a></span><span class="line">    <span class="mxinfo " id="T2:U124"><span class="var type1" id="S4T2U187">Rh</span>              = <span class="mxinfo " id="T2:U126">complex(<span class="mxinfo " id="T3:U127">1</span>,<span class="mxinfo " id="T3:U128">0</span>)</span></span>; <span class="comment">% -&gt; parallel polarization coefficient</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,59" id="srcline59">59</a></span><span class="line"><span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,60" id="srcline60">60</a></span><span class="line">    <span class="keyword">if</span> (<span class="mxinfo " id="T9:U129"><span class="var type1" id="S5T3U197">pblo</span> == <span class="mxinfo " id="T3:U131">-<span class="mxinfo " id="T3:U132">1</span></span></span>)</span></span>
<span class="srcline"><span class="lineno"><a href="1,61" id="srcline61">61</a></span><span class="line">        <span class="mxinfo " id="T2:U133"><span class="var type1" id="S40T2U202">Ct</span>          = <span class="mxinfo " id="T2:U135"><span class="mxinfo " id="T2:U136"><span class="var type1" id="S13T11U205">eta</span>(<span class="var type1" id="S6T3U206">blo</span>)</span>-<span class="var type1" id="S29T2U207">csfi2</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,62" id="srcline62">62</a></span><span class="line">        <span class="mxinfo " id="T2:U140"><span class="var type1" id="S41T2U210">Ch</span>          = <span class="mxinfo " id="T2:U142"><span class="var type1" id="S40T2U212">Ct</span>/<span class="mxinfo " id="T2:U144"><span class="mxinfo " id="T2:U145"><span class="var type1" id="S13T11U215">eta</span>(<span class="var type1" id="S6T3U216">blo</span>)</span>^2</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,63" id="srcline63">63</a></span><span class="line">    <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,64" id="srcline64">64</a></span><span class="line">        <span class="mxinfo " id="T2:U148"><span class="var type1" id="S40T2U221">Ct</span>          = <span class="mxinfo " id="T2:U150">(<span class="mxinfo " id="T2:U151"><span class="mxinfo " id="T2:U152"><span class="var type1" id="S13T11U226">eta</span>(<span class="var type1" id="S6T3U227">blo</span>)</span>/<span class="mxinfo " id="T2:U155"><span class="var type1" id="S13T11U229">eta</span>(<span class="var type1" id="S5T3U230">pblo</span>)</span></span>)-<span class="var type1" id="S29T2U231">csfi2</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,65" id="srcline65">65</a></span><span class="line">        <span class="mxinfo " id="T2:U159"><span class="var type1" id="S41T2U234">Ch</span>          = <span class="mxinfo " id="T2:U161"><span class="var type1" id="S40T2U236">Ct</span>/<span class="mxinfo " id="T2:U163">(<span class="mxinfo " id="T2:U164"><span class="mxinfo " id="T2:U165"><span class="var type1" id="S13T11U241">eta</span>(<span class="var type1" id="S6T3U242">blo</span>)</span>/<span class="mxinfo " id="T2:U168"><span class="var type1" id="S13T11U244">eta</span>(<span class="var type1" id="S5T3U245">pblo</span>)</span></span>)^2</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,66" id="srcline66">66</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,67" id="srcline67">67</a></span><span class="line">    <span class="mxinfo " id="T2:U171"><span class="var type1" id="S3T2U249">Rt</span>              = <span class="mxinfo " id="T2:U173">(<span class="mxinfo " id="T2:U174"><span class="var type1" id="S31T2U253">ccfi</span>-<span class="mxinfo " id="T2:U176">sqrt(<span class="var type1" id="S40T2U256">Ct</span>)</span></span>)/(<span class="mxinfo " id="T2:U178"><span class="var type1" id="S31T2U259">ccfi</span>+<span class="mxinfo " id="T2:U180">sqrt(<span class="var type1" id="S40T2U262">Ct</span>)</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,68" id="srcline68">68</a></span><span class="line">    <span class="mxinfo " id="T2:U182"><span class="var type1" id="S4T2U265">Rh</span>              = <span class="mxinfo " id="T2:U184">(<span class="mxinfo " id="T2:U185"><span class="var type1" id="S31T2U269">ccfi</span>-<span class="mxinfo " id="T2:U187">sqrt(<span class="var type1" id="S41T2U272">Ch</span>)</span></span>)/(<span class="mxinfo " id="T2:U189"><span class="var type1" id="S31T2U275">ccfi</span>+<span class="mxinfo " id="T2:U191">sqrt(<span class="var type1" id="S41T2U278">Ch</span>)</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,69" id="srcline69">69</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,70" id="srcline70">70</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,71" id="srcline71">71</a></span><span class="line"><span class="mxinfo " id="T2:U193"><span class="var type1" id="S42T2U281">fac</span>                 = <span class="mxinfo " id="T2:U195">exp(<span class="mxinfo " id="T2:U196"><span class="mxinfo " id="T2:U197"><span class="mxinfo " id="T2:U198">-1i</span>*<span class="var type1" id="S14T3U288">K</span></span>*<span class="var type1" id="S26T3U289">dr</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,72" id="srcline72">72</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,73" id="srcline73">73</a></span><span class="line"><span class="mxinfo " id="T1:U201"><span class="var type1" id="S2T1U292">Eout</span>                = <span class="mxinfo " id="T1:U203"><span class="var type1" id="S42T2U294">fac</span>*(<span class="mxinfo " id="T1:U205">(<span class="mxinfo " id="T1:U206"><span class="var type1" id="S37T4U299">ehr</span>*(<span class="mxinfo " id="T2:U208"><span class="var type1" id="S4T2U302">Rh</span>*<span class="var type1" id="S38T2U303">coEh</span></span>)</span>)+(<span class="mxinfo " id="T1:U211"><span class="var type1" id="S27T4U306">eti</span>*(<span class="mxinfo " id="T2:U213"><span class="var type1" id="S3T2U309">Rt</span>*<span class="var type1" id="S39T2U310">coEt</span></span>)</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,74" id="srcline74">74</a></span><span class="line"><span class="mxinfo " id="T1:U216"><span class="var type1" id="S2T1U313">Eout</span>                = <span class="mxinfo " id="T1:U218"><span class="mxinfo " id="T3:U219"><span class="var type1" id="S15T10U316">Rcoeff</span>(<span class="var type1" id="S6T3U317">blo</span>)</span>*<span class="var type1" id="S2T1U318">Eout</span></span></span>; <span class="comment">% updated on 18.10.2011: multiplying the field and the R coefficient that  </span></span></span>
</pre>
<div class="dead">
<pre class="code">
<span class="srcline"><span class="lineno"><a href="1,75" id="srcline75">75</a></span><span class="line">                                        <span class="comment">%                        takes into account the diffuse scattering power reduction</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,76" id="srcline76">76</a></span><span class="line"> </span></span>
</pre>
</div>
</body>
</html>
