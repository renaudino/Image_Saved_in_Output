<!-- saved from url=(0014)about:internet -->
<html>
<body>
<script src="resources/eml_report_loadable_data.js"></script>
<pre class="code">
<span class="srcline"><span class="lineno"><a href="53,1" id="srcline1"> 1</a></span><span class="line"><span class="keyword">function</span> [<span class="var type1" id="S2T1U3">appface</span>] = AppFace2 (<span class="var type1" id="S3T7U6">point_re</span>, <span class="var type1" id="S4T25U7">p_mat</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="53,2" id="srcline2"> 2</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="53,3" id="srcline3"> 3</a></span><span class="line"><span class="comment">%#codegen </span></span></span>
<span class="srcline"><span class="lineno"><a href="53,4" id="srcline4"> 4</a></span><span class="line"><span class="comment">% Function APPFACE checks if the point POINT_RE lies in the four-sided polygon which is defined by four points </span></span></span>
<span class="srcline"><span class="lineno"><a href="53,5" id="srcline5"> 5</a></span><span class="line"><span class="comment">% in the matrix P_MAT. Logical 1 is returned if the query point lies in the same plane as the four polygon </span></span></span>
<span class="srcline"><span class="lineno"><a href="53,6" id="srcline6"> 6</a></span><span class="line"><span class="comment">% points and if it is inside the polygon, logical 0 is returned otherwise. The algorithm for checking if the query </span></span></span>
<span class="srcline"><span class="lineno"><a href="53,7" id="srcline7"> 7</a></span><span class="line"><span class="comment">% point is in a polygon (in 2D space) can be found at:</span></span></span>
<span class="srcline"><span class="lineno"><a href="53,8" id="srcline8"> 8</a></span><span class="line"><span class="comment">% </span></span></span>
<span class="srcline"><span class="lineno"><a href="53,9" id="srcline9"> 9</a></span><span class="line"><span class="comment">% "An Efficient Test for a Point to Be in a Convex Polygon" from the Wolfram Demonstrations Project</span></span></span>
<span class="srcline"><span class="lineno"><a href="53,10" id="srcline10">10</a></span><span class="line"><span class="comment">%  http://demonstrations.wolfram.com/AnEfficientTestForAPointToBeInAConvexPolygon/</span></span></span>
<span class="srcline"><span class="lineno"><a href="53,11" id="srcline11">11</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="53,12" id="srcline12">12</a></span><span class="line"><span class="comment">% Define vectors spanning the plane in which the polygon lives</span></span></span>
<span class="srcline"><span class="lineno"><a href="53,13" id="srcline13">13</a></span><span class="line"><span class="mxinfo " id="T7:U4"><span class="var type1" id="S5T7U10">p21</span> = <span class="mxinfo " id="T7:U6"><span class="mxinfo " id="T7:U7"><span class="var type1" id="S4T25U13">p_mat</span>(<span class="mxinfo " id="T15:U9">:</span>,<span class="mxinfo " id="T16:U10">2</span>)</span>-<span class="mxinfo " id="T7:U11"><span class="var type1" id="S4T25U17">p_mat</span>(<span class="mxinfo " id="T15:U13">:</span>,<span class="mxinfo " id="T1:U14">1</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="53,14" id="srcline14">14</a></span><span class="line"><span class="mxinfo " id="T7:U15"><span class="var type1" id="S6T7U22">p41</span> = <span class="mxinfo " id="T7:U17"><span class="mxinfo " id="T7:U18"><span class="var type1" id="S4T25U25">p_mat</span>(<span class="mxinfo " id="T15:U20">:</span>,<span class="mxinfo " id="T1:U21">4</span>)</span>-<span class="mxinfo " id="T7:U22"><span class="var type1" id="S4T25U29">p_mat</span>(<span class="mxinfo " id="T15:U24">:</span>,<span class="mxinfo " id="T1:U25">1</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="53,15" id="srcline15">15</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="53,16" id="srcline16">16</a></span><span class="line"><span class="comment">% Calculating the planes normal vector and normalizing it</span></span></span>
<span class="srcline"><span class="lineno"><a href="53,17" id="srcline17">17</a></span><span class="line"><span class="mxinfo " id="T7:U26"><span class="var type1" id="S7T7U34">n</span>   = <span class="mxinfo " id="T7:U28"><span class="mxinfo " id="T21:U29">[<span class="mxinfo " id="T1:U30"><span class="mxinfo " id="T1:U31"><span class="mxinfo " id="T1:U32"><span class="var type1" id="S5T7U41">p21</span>(<span class="mxinfo " id="T16:U34">2</span>)</span>*<span class="mxinfo " id="T1:U35"><span class="var type1" id="S6T7U44">p41</span>(<span class="mxinfo " id="T1:U37">3</span>)</span></span>-<span class="mxinfo " id="T1:U38"><span class="mxinfo " id="T1:U39"><span class="var type1" id="S5T7U48">p21</span>(<span class="mxinfo " id="T1:U41">3</span>)</span>*<span class="mxinfo " id="T1:U42"><span class="var type1" id="S6T7U51">p41</span>(<span class="mxinfo " id="T1:U44">2</span>)</span></span></span> <span class="mxinfo " id="T1:U45"><span class="mxinfo " id="T1:U46"><span class="mxinfo " id="T1:U47"><span class="var type1" id="S5T7U56">p21</span>(<span class="mxinfo " id="T16:U49">3</span>)</span>*<span class="mxinfo " id="T1:U50"><span class="var type1" id="S6T7U59">p41</span>(<span class="mxinfo " id="T1:U52">1</span>)</span></span>-<span class="mxinfo " id="T1:U53"><span class="mxinfo " id="T1:U54"><span class="var type1" id="S5T7U63">p21</span>(<span class="mxinfo " id="T1:U56">1</span>)</span>*<span class="mxinfo " id="T1:U57"><span class="var type1" id="S6T7U66">p41</span>(<span class="mxinfo " id="T1:U59">3</span>)</span></span></span> <span class="mxinfo " id="T1:U60"><span class="mxinfo " id="T1:U61"><span class="mxinfo " id="T1:U62"><span class="var type1" id="S5T7U71">p21</span>(<span class="mxinfo " id="T16:U64">1</span>)</span>*<span class="mxinfo " id="T1:U65"><span class="var type1" id="S6T7U74">p41</span>(<span class="mxinfo " id="T1:U67">2</span>)</span></span>-<span class="mxinfo " id="T1:U68"><span class="mxinfo " id="T1:U69"><span class="var type1" id="S5T7U78">p21</span>(<span class="mxinfo " id="T1:U71">2</span>)</span>*<span class="mxinfo " id="T1:U72"><span class="var type1" id="S6T7U81">p41</span>(<span class="mxinfo " id="T1:U74">1</span>)</span></span></span>]</span>.'</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="53,18" id="srcline18">18</a></span><span class="line"><span class="mxinfo " id="T7:U75"><span class="var type1" id="S7T7U85">n</span>   = <span class="mxinfo " id="T7:U77"><span class="var type1" id="S7T7U87">n</span>/<span class="mxinfo " id="T1:U79">norm(<span class="var type1" id="S7T7U90">n</span>)</span></span></span>;   </span></span>
<span class="srcline"><span class="lineno"><a href="53,19" id="srcline19">19</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="53,20" id="srcline20">20</a></span><span class="line"><span class="comment">% If the vector to the query point and the normal vector are not othogonal, the query point is not within </span></span></span>
<span class="srcline"><span class="lineno"><a href="53,21" id="srcline21">21</a></span><span class="line"><span class="comment">% the plane or the polygon</span></span></span>
<span class="srcline"><span class="lineno"><a href="53,22" id="srcline22">22</a></span><span class="line"><span class="keyword">if</span> (<span class="mxinfo " id="T18:U81"><span class="mxinfo " id="T1:U82">abs((<span class="mxinfo " id="T1:U83"><span class="mxinfo " id="T21:U84"><span class="var type1" id="S7T7U100">n</span>.'</span>*(<span class="mxinfo " id="T7:U86"><span class="mxinfo " id="T7:U87"><span class="var type1" id="S3T7U104">point_re</span>(:)</span>-<span class="mxinfo " id="T7:U89"><span class="var type1" id="S4T25U107">p_mat</span>(<span class="mxinfo " id="T15:U91">:</span>,<span class="mxinfo " id="T1:U92">1</span>)</span></span>)</span>))</span> &gt; <span class="mxinfo " id="T1:U93">1e-6</span></span>)</span></span>
<span class="srcline"><span class="lineno"><a href="53,23" id="srcline23">23</a></span><span class="line">    <span class="mxinfo " id="T1:U94"><span class="var type1" id="S2T1U113">appface</span> = <span class="mxinfo " id="T1:U96">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="53,24" id="srcline24">24</a></span><span class="line">    <span class="keyword">return</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="53,25" id="srcline25">25</a></span><span class="line"><span class="comment">% If the vector to the query point and the normal vector are othogonal, rotate the plane to create </span></span></span>
<span class="srcline"><span class="lineno"><a href="53,26" id="srcline26">26</a></span><span class="line"><span class="comment">% a 2D problem and check if the point is within the polygon</span></span></span>
<span class="srcline"><span class="lineno"><a href="53,27" id="srcline27">27</a></span><span class="line"><span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="53,28" id="srcline28">28</a></span><span class="line">    <span class="comment">% Calculate the center of mass for the polygon</span></span></span>
<span class="srcline"><span class="lineno"><a href="53,29" id="srcline29">29</a></span><span class="line">    <span class="mxinfo " id="T7:U97"><span class="var type1" id="S10T7U119">mid</span> = <span class="mxinfo " id="T7:U99"><span class="mxinfo " id="T7:U100">sum(<span class="var type1" id="S4T25U123">p_mat</span>,2)</span>/4</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="53,30" id="srcline30">30</a></span><span class="line">    <span class="comment">% Calculate the orthogonal basis vectors for the new coordinate system</span></span></span>
<span class="srcline"><span class="lineno"><a href="53,31" id="srcline31">31</a></span><span class="line">    <span class="mxinfo " id="T7:U102"><span class="var type1" id="S12T7U128">b1</span> = <span class="mxinfo " id="T7:U104"><span class="var type1" id="S5T7U130">p21</span>/<span class="mxinfo " id="T1:U106">norm(<span class="var type1" id="S5T7U133">p21</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="53,32" id="srcline32">32</a></span><span class="line">    <span class="mxinfo " id="T7:U108"><span class="var type1" id="S13T7U136">b3</span> = <span class="var type1" id="S7T7U137">n</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="53,33" id="srcline33">33</a></span><span class="line">    <span class="mxinfo " id="T7:U111"><span class="var type1" id="S14T7U140">b2</span> = <span class="mxinfo " id="T7:U113"><span class="mxinfo " id="T21:U114">[<span class="mxinfo " id="T1:U115"><span class="mxinfo " id="T1:U116"><span class="mxinfo " id="T1:U117"><span class="var type1" id="S12T7U147">b1</span>(<span class="mxinfo " id="T16:U119">2</span>)</span>*<span class="mxinfo " id="T1:U120"><span class="var type1" id="S13T7U150">b3</span>(<span class="mxinfo " id="T1:U122">3</span>)</span></span>-<span class="mxinfo " id="T1:U123"><span class="mxinfo " id="T1:U124"><span class="var type1" id="S12T7U154">b1</span>(<span class="mxinfo " id="T1:U126">3</span>)</span>*<span class="mxinfo " id="T1:U127"><span class="var type1" id="S13T7U157">b3</span>(<span class="mxinfo " id="T1:U129">2</span>)</span></span></span> <span class="mxinfo " id="T1:U130"><span class="mxinfo " id="T1:U131"><span class="mxinfo " id="T1:U132"><span class="var type1" id="S12T7U162">b1</span>(<span class="mxinfo " id="T16:U134">3</span>)</span>*<span class="mxinfo " id="T1:U135"><span class="var type1" id="S13T7U165">b3</span>(<span class="mxinfo " id="T1:U137">1</span>)</span></span>-<span class="mxinfo " id="T1:U138"><span class="mxinfo " id="T1:U139"><span class="var type1" id="S12T7U169">b1</span>(<span class="mxinfo " id="T1:U141">1</span>)</span>*<span class="mxinfo " id="T1:U142"><span class="var type1" id="S13T7U172">b3</span>(<span class="mxinfo " id="T1:U144">3</span>)</span></span></span> <span class="mxinfo " id="T1:U145"><span class="mxinfo " id="T1:U146"><span class="mxinfo " id="T1:U147"><span class="var type1" id="S12T7U177">b1</span>(<span class="mxinfo " id="T16:U149">1</span>)</span>*<span class="mxinfo " id="T1:U150"><span class="var type1" id="S13T7U180">b3</span>(<span class="mxinfo " id="T1:U152">2</span>)</span></span>-<span class="mxinfo " id="T1:U153"><span class="mxinfo " id="T1:U154"><span class="var type1" id="S12T7U184">b1</span>(<span class="mxinfo " id="T1:U156">2</span>)</span>*<span class="mxinfo " id="T1:U157"><span class="var type1" id="S13T7U187">b3</span>(<span class="mxinfo " id="T1:U159">1</span>)</span></span></span>]</span>.'</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="53,34" id="srcline34">34</a></span><span class="line">    <span class="comment">% Transform the shifted polygon with new basis vectors</span></span></span>
<span class="srcline"><span class="lineno"><a href="53,35" id="srcline35">35</a></span><span class="line">    <span class="mxinfo " id="T25:U160"><span class="var type1" id="S15T25U191">pmat2d</span> = <span class="mxinfo " id="T25:U162"><span class="mxinfo " id="T54:U163"><span class="mxinfo " id="T54:U164">[<span class="var type1" id="S12T7U196">b1</span> <span class="var type1" id="S14T7U197">b2</span> <span class="var type1" id="S13T7U198">b3</span>]</span>.'</span>*(<span class="mxinfo " id="T25:U168"><span class="var type1" id="S4T25U201">p_mat</span>-<span class="mxinfo " id="T25:U170"><span class="var type1" id="S10T7U203">mid</span>*<span class="mxinfo " id="T53:U172">ones(<span class="mxinfo " id="T1:U173">1</span>,<span class="mxinfo " id="T1:U174">4</span>)</span></span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="53,36" id="srcline36">36</a></span><span class="line">    <span class="comment">% Actual algorithm checking if the query point lies within the polygon, first shift the coordinate system such that </span></span></span>
<span class="srcline"><span class="lineno"><a href="53,37" id="srcline37">37</a></span><span class="line">    <span class="comment">% the query point coincides with the coordinate origin</span></span></span>
<span class="srcline"><span class="lineno"><a href="53,38" id="srcline38">38</a></span><span class="line">    <span class="mxinfo " id="T25:U175"><span class="var type1" id="S17T25U210">pmat0</span> = <span class="mxinfo " id="T25:U177"><span class="var type1" id="S15T25U212">pmat2d</span>-<span class="mxinfo " id="T25:U179"><span class="mxinfo " id="T7:U180"><span class="mxinfo " id="T54:U181"><span class="mxinfo " id="T54:U182">[<span class="var type1" id="S12T7U218">b1</span> <span class="var type1" id="S14T7U219">b2</span> <span class="var type1" id="S13T7U220">b3</span>]</span>.'</span>*(<span class="mxinfo " id="T7:U186"><span class="mxinfo " id="T7:U187"><span class="var type1" id="S3T7U224">point_re</span>(:)</span>-<span class="var type1" id="S10T7U226">mid</span></span>)</span>*<span class="mxinfo " id="T53:U190">ones(<span class="mxinfo " id="T1:U191">1</span>,<span class="mxinfo " id="T1:U192">4</span>)</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="53,39" id="srcline39">39</a></span><span class="line">    <span class="comment">% Only consider two dimensions and add the first point as last point</span></span></span>
<span class="srcline"><span class="lineno"><a href="53,40" id="srcline40">40</a></span><span class="line">    <span class="mxinfo " id="T57:U193"><span class="var type1" id="S18T57U233">pmat0e</span> = <span class="mxinfo " id="T57:U195">[<span class="mxinfo " id="T58:U196"><span class="var type1" id="S17T25U237">pmat0</span>(<span class="mxinfo " id="T30:U198">1:2</span>,<span class="mxinfo " id="T28:U199">:</span>)</span> <span class="mxinfo " id="T10:U200"><span class="var type1" id="S17T25U243">pmat0</span>(<span class="mxinfo " id="T30:U202">1:2</span>,<span class="mxinfo " id="T16:U203">1</span>)</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="53,41" id="srcline41">41</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="53,42" id="srcline42">42</a></span><span class="line">    <span class="comment">% Check if the angles between two vertices of the polygon (has to be counterclockwisely defined!) change sign</span></span></span>
<span class="srcline"><span class="lineno"><a href="53,43" id="srcline43">43</a></span><span class="line">    <span class="mxinfo " id="T55:U204"><span class="var type1" id="S19T55U250">angle_sign</span> = (<span class="mxinfo " id="T55:U206">(<span class="mxinfo " id="T53:U207"><span class="mxinfo " id="T53:U208"><span class="mxinfo " id="T53:U209"><span class="var type1" id="S18T57U257">pmat0e</span>(<span class="mxinfo " id="T16:U211">1</span>,<span class="mxinfo " id="T28:U212">2:end</span>)</span>.*<span class="mxinfo " id="T53:U213"><span class="var type1" id="S18T57U264">pmat0e</span>(<span class="mxinfo " id="T1:U215">2</span>,<span class="mxinfo " id="T53:U216"><span class="mxinfo " id="T1:U217">1</span>:<span class="mxinfo " id="T1:U218">end-1</span></span>)</span></span>-<span class="mxinfo " id="T53:U219"><span class="mxinfo " id="T53:U220"><span class="var type1" id="S18T57U274">pmat0e</span>(<span class="mxinfo " id="T1:U222">1</span>,<span class="mxinfo " id="T53:U223"><span class="mxinfo " id="T1:U224">1</span>:<span class="mxinfo " id="T1:U225">end-1</span></span>)</span>.*<span class="mxinfo " id="T53:U226"><span class="var type1" id="S18T57U283">pmat0e</span>(<span class="mxinfo " id="T1:U228">2</span>,<span class="mxinfo " id="T53:U229"><span class="mxinfo " id="T1:U230">2</span>:<span class="mxinfo " id="T1:U231">end</span></span>)</span></span></span>) &gt;= <span class="mxinfo " id="T1:U232">0</span></span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="53,44" id="srcline44">44</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="53,45" id="srcline45">45</a></span><span class="line">	<span class="comment">% If no angle sign change occured, query point is within polygon</span></span></span>
<span class="srcline"><span class="lineno"><a href="53,46" id="srcline46">46</a></span><span class="line">    <span class="keyword">if</span> (<span class="mxinfo " id="T18:U233"><span class="mxinfo " id="T1:U234">sum(<span class="var type1" id="S19T55U296">angle_sign</span>)</span> == <span class="mxinfo " id="T1:U236">4</span></span>)</span></span>
<span class="srcline"><span class="lineno"><a href="53,47" id="srcline47">47</a></span><span class="line">        <span class="mxinfo " id="T1:U237"><span class="var type1" id="S2T1U300">appface</span> = <span class="mxinfo " id="T1:U239">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="53,48" id="srcline48">48</a></span><span class="line">    <span class="comment">% If angle sign change occured, query point is not within polygon</span></span></span>
<span class="srcline"><span class="lineno"><a href="53,49" id="srcline49">49</a></span><span class="line">    <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="53,50" id="srcline50">50</a></span><span class="line">        <span class="mxinfo " id="T1:U240"><span class="var type1" id="S2T1U305">appface</span> = <span class="mxinfo " id="T1:U242">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="53,51" id="srcline51">51</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="53,52" id="srcline52">52</a></span><span class="line"><span class="keyword"><span class="keyword">end</span></span></span></span>
</pre>
</body>
</html>
